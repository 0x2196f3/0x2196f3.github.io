<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>0x2196f3's blog</title><link>/</link><description>0x2196f3's blog</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Tue, 30 Dec 2025 00:00:00 +0000</lastBuildDate><atom:link href="/index.xml" rel="self" type="application/rss+xml"/><item><title>Xiaomi AX6000刷OpenWRT</title><link>/posts/xiaomi-ax6000-openwrt/</link><pubDate>Tue, 30 Dec 2025 00:00:00 +0000</pubDate><guid>/posts/xiaomi-ax6000-openwrt/</guid><description>&lt;h1 id="已知问题" >
&lt;div>
&lt;a href="#%e5%b7%b2%e7%9f%a5%e9%97%ae%e9%a2%98">
##
&lt;/a>
已知问题
&lt;/div>
&lt;/h1>
&lt;h2 id="openwrt-25120-rc1已知问题" >
&lt;div>
&lt;a href="#openwrt-25120-rc1%e5%b7%b2%e7%9f%a5%e9%97%ae%e9%a2%98">
#
&lt;/a>
OpenWRT 25.12.0-rc1已知问题
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>5Ghz Wifi,信道选auto无法启动,需要手动设置信道为36&lt;/li>
&lt;li>5Ghz Wifi即使开启160mhz也无法协商到超过1200mbps,测速跑不满千兆,对无线速度有要求就再等等&lt;/li>
&lt;li>虽然路由器有128mb闪存,但OpenWRT可用容量仅60mb&lt;/li>
&lt;li>内存占用异常:不装任何插件内存占用300mb+(正常情况下512mb内存应该占用200mb左右)&lt;/li>
&lt;/ul>
&lt;h2 id="路由器自身的问题" >
&lt;div>
&lt;a href="#%e8%b7%af%e7%94%b1%e5%99%a8%e8%87%aa%e8%ba%ab%e7%9a%84%e9%97%ae%e9%a2%98">
#
&lt;/a>
路由器自身的问题
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>这款路由器三个千兆网口共享1G带宽,无线/有线都基本不可能跑满2.5G,不建议为了能刷机购买.见&lt;a href="https://www.acwifi.net/12621.html">acwifi评测&lt;/a>&lt;/li>
&lt;li>IPQ5018处理器性能较弱(双核1GHZ A53,相当于不到半个NanoPi R2s软路由),且OpenWRT不支持硬件NAT加速,不建议用于拨号/翻墙&lt;/li>
&lt;/ul>
&lt;h1 id="刷机步骤" >
&lt;div>
&lt;a href="#%e5%88%b7%e6%9c%ba%e6%ad%a5%e9%aa%a4">
##
&lt;/a>
刷机步骤
&lt;/div>
&lt;/h1>
&lt;h2 id="1降级到1055" >
&lt;div>
&lt;a href="#1%e9%99%8d%e7%ba%a7%e5%88%b01055">
#
&lt;/a>
1.降级到1.0.55
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://mirom.ezbox.idv.tw/miwifi/RA72/roms-stable/">Xiaomi AX6000历史固件下载&lt;/a>&lt;br>
实测最新稳定版(1.0.122)可以直接降级到1.0.55&lt;/p>
&lt;h2 id="2使用xmir-patcher解锁ssh" >
&lt;div>
&lt;a href="#2%e4%bd%bf%e7%94%a8xmir-patcher%e8%a7%a3%e9%94%81ssh">
#
&lt;/a>
2.使用&lt;a href="https://github.com/openwrt-xiaomi/xmir-patcher">xmir-patcher&lt;/a>解锁ssh
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>网上搜到的教程解锁ssh需要装OpenWRT虚拟机开无线热点,现在xmir-patcher开箱即用,不需要管理员权限,可以自动获取sn/计算root密码/开启ssh/备份固件/刷机&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>下载并解压&lt;a href="https://github.com/openwrt-xiaomi/xmir-patcher/archive/refs/heads/main.zip">源码.zip&lt;/a>,点击&lt;code>run.bat&lt;/code>
双击&lt;code>run.bat&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmd" data-lang="cmd">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>==========================================================
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Xiaomi MiR Patcher
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 1 - Set IP-address (current value: 192.168.31.1)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2 - Connect to device (install exploit)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3 - Read full device info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 4 - Create full backup
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 5 - Install EN/RU languages
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 6 - Install permanent SSH
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 7 - Install firmware (from directory &lt;span style="color:#e6db74">&amp;#34;firmware&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 8 - {{{ Other functions }}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 9 - [[ Reboot device ]]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 0 - Exit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Select:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>选2 解锁ssh&lt;/p>
&lt;h2 id="3备份" >
&lt;div>
&lt;a href="#3%e5%a4%87%e4%bb%bd">
#
&lt;/a>
3.备份
&lt;/div>
&lt;/h2>
&lt;p>选4 备份闪存内容,刷回原版有用,但变砖可能要拆机救&lt;br>
选6 固化ssh&lt;/p>
&lt;h2 id="4下载openwrt固件" >
&lt;div>
&lt;a href="#4%e4%b8%8b%e8%bd%bdopenwrt%e5%9b%ba%e4%bb%b6">
#
&lt;/a>
4.下载Openwrt固件
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://firmware-selector.openwrt.org/">openwrt firmware-selector&lt;/a>
选择Xiaomi AX6000, 25.12.x&lt;/p>
&lt;p>下载第一个&lt;strong>SYSTEMUPGRADE&lt;/strong> (xxx-squashfs-sysupgrade.bin)&lt;br>
和第三个&lt;strong>INITRAMFS-FACTORY&lt;/strong> (xxx-initramfs-factory.ubi)&lt;/p>
&lt;h2 id="5刷机" >
&lt;div>
&lt;a href="#5%e5%88%b7%e6%9c%ba">
#
&lt;/a>
5.刷机
&lt;/div>
&lt;/h2>
&lt;p>将&lt;code>...-initramfs-factory.ubi&lt;/code>放入&lt;code>./xmir-patcher-main/firmware&lt;/code>&lt;/p>
&lt;p>选7 刷机&lt;/p>
&lt;ul>
&lt;li>OpenWRT默认不开启WIFI,必须连网线&lt;/li>
&lt;li>OpenWRT默认ip是&lt;code>192.168.1.1&lt;/code>,首次开机不要接上游避免ip冲突&lt;/li>
&lt;/ul>
&lt;p>重启连接网线到lan口(三个千兆口的任意一个),浏览器输入&lt;code>192.168.1.1&lt;/code>即可进入luci界面,没有密码.&lt;/p>
&lt;p>在System -&amp;gt; Backup / Flash Firmware -&amp;gt; Flash Image&lt;br>
刷入&lt;code>...-squashfs-sysupgrade.bin&lt;/code>&lt;/p>
&lt;p>重启&lt;/p>
&lt;h1 id="参考" >
&lt;div>
&lt;a href="#%e5%8f%82%e8%80%83">
##
&lt;/a>
参考
&lt;/div>
&lt;/h1>
&lt;p>&lt;a href="https://www.bilibili.com/opus/1079010971533443094">小米 AX6000 刷 OpenWrt&lt;/a>&lt;/p></description></item><item><title>给套Cloudflare CDN的节点开启ECH</title><link>/posts/xray-mihomo-enable-ech-for-cloudflare-nodes/</link><pubDate>Thu, 25 Dec 2025 00:00:00 +0000</pubDate><guid>/posts/xray-mihomo-enable-ech-for-cloudflare-nodes/</guid><description>&lt;h1 id="参考" >
&lt;div>
&lt;a href="#%e5%8f%82%e8%80%83">
##
&lt;/a>
参考
&lt;/div>
&lt;/h1>
&lt;p>&lt;a href="https://www.chonglangtv.org/t/topic/625">[5] 冲浪小本本儿 (二)(2-2)—-http-https-ECH 最广泛、最真实、最管用的互联网隐私保护[3]— ECH详谈&lt;/a>&lt;/p>
&lt;h1 id="省流" >
&lt;div>
&lt;a href="#%e7%9c%81%e6%b5%81">
##
&lt;/a>
省流
&lt;/div>
&lt;/h1>
&lt;ul>
&lt;li>启用ECH的https连接从外观上(从ISP/GFW的角度观测)除了sni是&lt;code>某ech域名&lt;/code>之外和明文client hello的https连接没有明显的区别&lt;/li>
&lt;li>由于启用ECH时任何到Cloudflare CDN的https连接sni都是&lt;code>cloudflare-ech.com&lt;/code>,GFW阻断该域名Cloudflare的ECH就不能用了&lt;/li>
&lt;li>对于翻墙软件,只要有正确的ECH Config即可建立ECH连接,不论这个ECH Config原本是给哪个域名的,是提前配置的固定值/明文DNS查询到的/DoH查询到的&lt;/li>
&lt;li>使用Cloudflare CDN的所有网站在同一时刻共用同一个ECH Config,但ECH Config几小时就会换一个&lt;br>
这代表:&lt;br>
1.Cloudflare CDN上任何网站的ECH Config都可以用于连接任意使用Cloudflare CDN的域名(即使该域名查不到ECH Config也可以强制ECH连接)&lt;br>
2.即使一个域名被DNS污染+SNI阻断,拿到Cloudflare CDN的ip和ECH Config即可使用&lt;code>cloudflare-ech.com&lt;/code>的sni连接cloudflare的ip访问该网站&lt;br>
3.不能将事先查好的ECH Config写在翻墙软件的配置文件里,几小时就过期了,需要每次连接时向DNS服务器查询&lt;/li>
&lt;li>目前国内存在能返回Cloudflare的正确ECH Config的明文DNS或DoH服务器,但以后可能全部被污染.最好自建一个私人DoH服务器&lt;/li>
&lt;/ul>
&lt;h1 id="客户端配置" >
&lt;div>
&lt;a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae">
##
&lt;/a>
客户端配置
&lt;/div>
&lt;/h1>
&lt;p>对于套Cloudflare CDN的节点,ECH由Cloudflare的边缘服务器处理,自己的翻墙服务器和Cloudflare面板上不需要任何配置:ECH默认启用且免费账号不能禁用&lt;/p>
&lt;h2 id="xray客户端" >
&lt;div>
&lt;a href="#xray%e5%ae%a2%e6%88%b7%e7%ab%af">
#
&lt;/a>
Xray客户端
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://xtls.github.io/config/transport.html#tlsobject">文档&lt;/a>&lt;br>
支持编辑ECH的GUI目前基本没有,需要直接改json&lt;/p>
&lt;blockquote>
&lt;p>在tlsSettings里添加&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;tlsSettings&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">:&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;echConfigList&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;cloudflare-ech.com+https://dns.alidns.com/dns-query&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;echForceQuery&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;full&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>full:无法获取ECH Config就断开连接(推荐)&lt;/li>
&lt;li>half/none:无法获取ECH Config时回退到明文Client Hello,会暴露域名&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>或在分享链接里添加(大多数GUI目前还不支持)&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>&amp;amp;ech=cloudflare-ech.com%2Bhttps%3A%2F%2Fdns.alidns.com%2Fdns-query&amp;amp;
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>&lt;code>cloudflare-ech.com+https://dns.alidns.com/dns-query&lt;/code>的意思?&lt;/p>&lt;/blockquote>
&lt;p>向&lt;code>dns.alidns.com&lt;/code>这个DoH服务器发起HTTPS(65)查询,域名是&lt;code>cloudflare-ech.com&lt;/code>,使用DoH服务器返回的(原本是给&lt;code>cloudflare-ech.com&lt;/code>用的)ECH Config对你节点的ip和域名建立ECH连接&lt;/p>
&lt;h2 id="mihomo客户端" >
&lt;div>
&lt;a href="#mihomo%e5%ae%a2%e6%88%b7%e7%ab%af">
#
&lt;/a>
Mihomo客户端
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">ech-opts&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">enable&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>需要给节点设置一个能查到ECH Config的DNS服务器&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">dns&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">enable&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy-server-nameserver&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">https://dns.alidns.com/dns-query&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://wiki.metacubex.one/config/proxies/tls/#ech-opts">文档&lt;/a>里没写的:&lt;/p>
&lt;ul>
&lt;li>不支持从proxy provider的vless分享链接的&lt;code>ech&lt;/code>字段里读取ech config.&lt;br>
&lt;code>alpha-498f81a&lt;/code>版本的&lt;code>common/convert/converter.go&lt;/code> 206行和&lt;code>common/convert/v.go&lt;/code>,vless没有处理ech字段&lt;/li>
&lt;li>不支持用&lt;strong>DNS查询其它域名&lt;/strong>获取的ECH Config连接节点&lt;br>
见&lt;a href="https://github.com/MetaCubeX/mihomo/pull/2411/commits">feat: allow custom ECH domain#2411&lt;/a>&lt;/li>
&lt;li>在无法获取ECH Config时无法建立连接,不会回退到明文Client Hello.&lt;br>
实测ISP默认DNS查不到ECH Config,此时节点完全无法连接,&lt;code>proxy-server-nameserver&lt;/code>切换到&lt;code>dns.alidns.com&lt;/code>后能正常连接 &lt;del>懒得翻代码了&lt;/del>&lt;/li>
&lt;/ul>
&lt;h1 id="可能的用法" >
&lt;div>
&lt;a href="#%e5%8f%af%e8%83%bd%e7%9a%84%e7%94%a8%e6%b3%95">
##
&lt;/a>
可能的用法
&lt;/div>
&lt;/h1>
&lt;ol>
&lt;li>由于开启ech后所有连接sni都是&lt;code>cloudflare-ech.com&lt;/code>,一个节点的多个CDN ip做负载均衡,在ISP/GFW看起来就像在访问Cloudflare上不同的网站?&lt;/li>
&lt;li>&lt;a href="https://github.com/XTLS/Xray-core/discussions/5199">使用Xray进行MitM代理，强制使用ECH，直连所有CF网站&lt;/a>&lt;/li>
&lt;/ol>
&lt;h1 id="测试" >
&lt;div>
&lt;a href="#%e6%b5%8b%e8%af%95">
##
&lt;/a>
测试
&lt;/div>
&lt;/h1>
&lt;h2 id="准备" >
&lt;div>
&lt;a href="#%e5%87%86%e5%a4%87">
#
&lt;/a>
准备
&lt;/div>
&lt;/h2>
&lt;p>一个Debian 13虚拟机&lt;br>
能访问&lt;code>dns.google&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo apt install dnsutils
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>使用ISP分配的默认DNS查询HTTPS解析&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dig HTTPS cloudflare-ech.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>使用ISP分配的默认DNS查询A解析&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dig A cloudflare-ech.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>使用&lt;code>223.5.5.5&lt;/code>明文DNS查询HTTPS解析&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dig HTTPS cloudflare-ech.com @223.5.5.5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>使用&lt;code>https://dns.alidns.com&lt;/code>DoH查询HTTPS解析&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dig HTTPS cloudflare-ech.com +https @dns.alidns.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>使用&lt;code>dns.google&lt;/code>查询&lt;code>www.qbittorrent.org&lt;/code>的HTTPS解析&lt;/p>&lt;/blockquote>
&lt;p>浏览器输入&lt;code>https://dns.google/query?name=www.qbittorrent.org&amp;amp;rr_type=https&amp;amp;ecs=&lt;/code>&lt;/p>
&lt;h2 id="国内dns对ech的支持" >
&lt;div>
&lt;a href="#%e5%9b%bd%e5%86%85dns%e5%af%b9ech%e7%9a%84%e6%94%af%e6%8c%81">
#
&lt;/a>
国内DNS对ECH的支持?
&lt;/div>
&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Domain&lt;/th>
&lt;th>ISP默认DNS (plain)&lt;/th>
&lt;th>223.5.5.5 (plain)&lt;/th>
&lt;th>dns.alidns.com (DOH)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>cloudflare-ech.com&lt;/td>
&lt;td>timeout&lt;/td>
&lt;td>ECH config found&lt;/td>
&lt;td>ECH config found&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>baidu.com&lt;/td>
&lt;td>timeout&lt;/td>
&lt;td>ECH config not found&lt;/td>
&lt;td>ECH config not found&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>阿里DNS即使域名不支持ECH也立刻返回结果,不会超时,但ISP分配的默认DNS,所有HTTPS(65)请求都超时&lt;/p>
&lt;ul>
&lt;li>说明明文DNS也能查询到ECH Config&lt;/li>
&lt;li>说明有些DNS屏蔽了全部HTTPS查询&lt;/li>
&lt;/ul>
&lt;h2 id="哪些域名能查到coudflare分配的ech-config" >
&lt;div>
&lt;a href="#%e5%93%aa%e4%ba%9b%e5%9f%9f%e5%90%8d%e8%83%bd%e6%9f%a5%e5%88%b0coudflare%e5%88%86%e9%85%8d%e7%9a%84ech-config">
#
&lt;/a>
哪些域名能查到Coudflare分配的ECH CONFIG?
&lt;/div>
&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Domain&lt;/th>
&lt;th>国内&lt;/th>
&lt;th>国外&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>cloudflare-ech.com&lt;/td>
&lt;td>✔&lt;/td>
&lt;td>✔&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>servo.org&lt;/td>
&lt;td>✔&lt;/td>
&lt;td>✔&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://www.qbittorrent.org">www.qbittorrent.org&lt;/a>&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✔&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>rutracker.org&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✔&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cloudflare.com&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✖&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>speed.cloudflare.com&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✖&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>japan.com&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✖&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>visa.com.sg&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✖&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>visa.com.hk&lt;/td>
&lt;td>✖&lt;/td>
&lt;td>✖&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;a href="https://github.com/net4people/bbs/issues/393#issuecomment-2365428913">部分可查到Cloudflare ECH Config的域名&lt;/a>&lt;/p>
&lt;ul>
&lt;li>以前cloudflare优选ip常用的域名都查不到,可能是付费用户默认不启用或主动关闭了ECH&lt;/li>
&lt;/ul></description></item><item><title>Hysteria2测试</title><link>/posts/hysteria2-test/</link><pubDate>Fri, 12 Dec 2025 00:00:00 +0000</pubDate><guid>/posts/hysteria2-test/</guid><description>&lt;h1 id="使用自签证书的安全提示" >
&lt;div>
&lt;a href="#%e4%bd%bf%e7%94%a8%e8%87%aa%e7%ad%be%e8%af%81%e4%b9%a6%e7%9a%84%e5%ae%89%e5%85%a8%e6%8f%90%e7%a4%ba">
##
&lt;/a>
使用自签证书的安全提示
&lt;/div>
&lt;/h1>
&lt;ol>
&lt;li>此时hysteria无法防御主动探测,因为无法提供伪装网站的合法ssl证书.&lt;br>
所以想精准识别hysteria非常容易,现在不封只是GFW对quic的封锁还不成熟.&lt;/li>
&lt;li>客户端建议pin自签的证书,否则被中间人攻击时客户端无法察觉&lt;/li>
&lt;/ol>
&lt;h1 id="性能" >
&lt;div>
&lt;a href="#%e6%80%a7%e8%83%bd">
##
&lt;/a>
性能
&lt;/div>
&lt;/h1>
&lt;p>使用bbr时跑100mbps对性能没有什么要求&lt;/p>
&lt;h1 id="速度测试" >
&lt;div>
&lt;a href="#%e9%80%9f%e5%ba%a6%e6%b5%8b%e8%af%95">
##
&lt;/a>
速度测试
&lt;/div>
&lt;/h1>
&lt;p>正常情况下quic直连墙外会被阻断到无法使用.&lt;/p>
&lt;p>比如&lt;a href="https://dash.cloudflare.com">dash.cloudflare.com&lt;/a>,F12-&amp;gt;Network可以看到大量使用h3下载的js,速度极慢导致网页&lt;strong>全天&lt;/strong>完全不可用,只有浏览器/路由器禁用h3才能正常登录.&lt;/p>
&lt;p>但是某垃圾VPS晚高峰测速,hysteria仅用bbr就能100+mbps&lt;/p>
&lt;p>可能因为sni=&lt;code>bing.com&lt;/code>在白名单里所以没有被限速/丢包&lt;/p>
&lt;p>同ip同端口的reality(同ASN的小众域名)被限速0.5mbps,说明过墙的h3不是拥堵而是是被ISP/GFW主动劣化到不能用的&lt;/p>
&lt;h1 id="tips" >
&lt;div>
&lt;a href="#tips">
##
&lt;/a>
Tips
&lt;/div>
&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>如果用别人的域名,因为不防主动探测,建议使用ipv6部署hysteria,封了换ip比较容易.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GFW审查quic的成本高于其它基于tcp的协议,因为quic里传输的所有内容都是加密的,从加密的quic中解密出client hello里的sni的计算量比直接从tcp中读取明文sni大.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>使用docker &lt;code>-p [::]:443:443/udp&lt;/code>即可&lt;strong>仅&lt;/strong>让此容器监听ipv6发来的udp数据包,同时另一个容器监听同端口的tcp连接&lt;code>-p 443:443/tcp&lt;/code>.达成hysteria和xray在同ip的443端口共存&lt;br>
&lt;del>相同的[ip+port],udp和tcp的sni不同也可能是特征&lt;/del>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>即使使用bbr+真实域名,hysteria也不能套CDN,想套CDN并使用quic过墙可以尝试xray的xhttp&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="部署" >
&lt;div>
&lt;a href="#%e9%83%a8%e7%bd%b2">
##
&lt;/a>
部署
&lt;/div>
&lt;/h1>
&lt;h2 id="服务端" >
&lt;div>
&lt;a href="#%e6%9c%8d%e5%8a%a1%e7%ab%af">
#
&lt;/a>
服务端
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>安装docker&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>创建一个hysteria目录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mkdir hysteria &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> cd hysteria
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>生成自签证书&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>openssl req -x509 -nodes -newkey ec:&amp;lt;&lt;span style="color:#f92672">(&lt;/span>openssl ecparam -name prime256v1&lt;span style="color:#f92672">)&lt;/span> -keyout ./server.key -out ./server.crt -subj &lt;span style="color:#e6db74">&amp;#34;/CN=bing.com&amp;#34;&lt;/span> -days &lt;span style="color:#ae81ff">36500&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>生成配置文件&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nano hysteria.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">tls&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cert&lt;/span>: &lt;span style="color:#ae81ff">/etc/hysteria/server.crt&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">key&lt;/span>: &lt;span style="color:#ae81ff">/etc/hysteria/server.key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">auth&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">password&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">password&lt;/span>: &lt;span style="color:#ae81ff">123456&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">masquerade&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">proxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">url&lt;/span>: &lt;span style="color:#ae81ff">https://bing.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">rewriteHost&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>运行&amp;amp;开机自启动&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run -d --name hysteria --pull always --restart always -p 443:443/udp -v ./hysteria/:/etc/hysteria/ tobyxdd/hysteria server -c /etc/hysteria/hysteria.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>检查hysteria是否正常运行&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker logs hysteria
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="客户端" >
&lt;div>
&lt;a href="#%e5%ae%a2%e6%88%b7%e7%ab%af">
#
&lt;/a>
客户端
&lt;/div>
&lt;/h2>
&lt;h3 id="hysteria官方客户端" >
&lt;div>
&lt;a href="#hysteria%e5%ae%98%e6%96%b9%e5%ae%a2%e6%88%b7%e7%ab%af">
##
&lt;/a>
Hysteria官方客户端
&lt;/div>
&lt;/h3>
&lt;ul>
&lt;li>长期使用建议直接用sing-box或mihomo&lt;/li>
&lt;/ul>
&lt;p>Windows:下载&lt;a href="https://github.com/apernet/hysteria/releases">hysteria-windows-amd64-avx.exe&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>config.yaml,保存到exe同目录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">server&lt;/span>: [&lt;span style="color:#ae81ff">your-ip]:[your-port]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">auth&lt;/span>: [&lt;span style="color:#ae81ff">your-password]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">tls&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sni&lt;/span>: &lt;span style="color:#ae81ff">bing.com &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">insecure&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">http&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span>: &lt;span style="color:#ae81ff">127.0.0.1&lt;/span>:&lt;span style="color:#ae81ff">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">disableUDP&lt;/span>: &lt;span style="color:#66d9ef">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我的Windows无法开启Socks5代理,只用http&lt;/p>
&lt;ul>
&lt;li>手动将系统代理设置为&lt;code>127.0.0.1:8080&lt;/code>&lt;/li>
&lt;li>或Firefox里单独给浏览器设置代理&lt;/li>
&lt;/ul>
&lt;h3 id="mihomo" >
&lt;div>
&lt;a href="#mihomo">
##
&lt;/a>
Mihomo
&lt;/div>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">your-hysteria-name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">hysteria2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">server&lt;/span>: [&lt;span style="color:#ae81ff">your-ip]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">port&lt;/span>: [&lt;span style="color:#ae81ff">your-port]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">password&lt;/span>: [&lt;span style="color:#ae81ff">your-password]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">sni&lt;/span>: &lt;span style="color:#ae81ff">bing.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">skip-cert-verify&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">alpn&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#ae81ff">h3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Windows关机时自动关闭未保存的程序</title><link>/posts/windows-autoendtasks/</link><pubDate>Tue, 11 Nov 2025 00:00:00 +0000</pubDate><guid>/posts/windows-autoendtasks/</guid><description>&lt;p>在关机时自动关闭所有提示保存的程序,否则默认状态下什么都不做电脑永远不会关&lt;/p>
&lt;pre tabindex="0">&lt;code>Windows Registry Editor Version 5.00
; Created by: Shawn Brink
; Created on: November 12th 2017
; Tutorial: https://www.tenforums.com/tutorials/97821-turn-autoendtasks-restart-shut-down-sign-out-windows-10-a.html
[HKEY_USERS\.DEFAULT\Control Panel\Desktop]
&amp;#34;AutoEndTasks&amp;#34;=&amp;#34;1&amp;#34;
&lt;/code>&lt;/pre></description></item><item><title>WHEA-Logger-17排查</title><link>/posts/whea-logger-17-fix/</link><pubDate>Mon, 10 Nov 2025 00:00:00 +0000</pubDate><guid>/posts/whea-logger-17-fix/</guid><description>&lt;h3 id="症状" >
&lt;div>
&lt;a href="#%e7%97%87%e7%8a%b6">
##
&lt;/a>
症状
&lt;/div>
&lt;/h3>
&lt;p>Windows服务器不定期死机&lt;/p>
&lt;h3 id="排查" >
&lt;div>
&lt;a href="#%e6%8e%92%e6%9f%a5">
##
&lt;/a>
排查
&lt;/div>
&lt;/h3>
&lt;p>Event Viewer 大量 WHEA-Logger-17的warning,只要一开机warning数量持续增加,几小时几万个&lt;/p>
&lt;p>warning内容&lt;/p>
&lt;pre tabindex="0">&lt;code>发生了已更正的硬件错误。
组件: PCI Express Root Port
错误源: Advanced Error Reporting (PCI Express)
主总线: 设备: 函数: 0x0: 0x1: 0x0
辅助总线: 设备: 函数: 0x0: 0x0: 0x0
主要设备名称: PCI\VEN_8086&amp;amp;DEV_A70D&amp;amp;SUBSYS_00000000&amp;amp;REV_01
辅助设备名称:
&lt;/code>&lt;/pre>&lt;p>查询DEV_A70D是哪个设备&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Powershell" data-lang="Powershell">&lt;span style="display:flex;">&lt;span>Get-PnpDevice -PresentOnly | Where-Object { $_.InstanceId &lt;span style="color:#f92672">-match&lt;/span> &lt;span style="color:#e6db74">&amp;#39;A70D&amp;#39;&lt;/span> } | Select-Object InstanceId, FriendlyName, Class, Status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>输出&lt;/p>
&lt;pre tabindex="0">&lt;code>InstanceId FriendlyName Class Status
---------- ------------ ----- ------
PCI\VEN_8086&amp;amp;DEV_A70D&amp;amp;SUBSYS_00000000&amp;amp;REV_01\3&amp;amp;11583659&amp;amp;0&amp;amp;08 Intel(R) PCIe RC 010 G5 - A70D System OK
&lt;/code>&lt;/pre>&lt;p>GPT说G5可能代表PCIE5.0,这张主板是B760,只有显卡的PCIEx16支持PCIE5.0,确定是显卡的接口&lt;/p>
&lt;h3 id="解决方案" >
&lt;div>
&lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88">
##
&lt;/a>
解决方案
&lt;/div>
&lt;/h3>
&lt;p>GPT说已更正的硬件错误可能是PCIE接口物理接触不良/PCIE的ASPM(节能模式)配置&lt;/p>
&lt;ul>
&lt;li>添加显卡支架把显卡扶正,无效&lt;/li>
&lt;li>重置BIOS,ASPM全默认,无效&lt;/li>
&lt;li>把PCIE版本从auto调成4.0,warning再没有增加&lt;/li>
&lt;/ul>
&lt;p>该主板说明书只说支持PCIE4.0,但是最新BIOS的PCIE默认auto似乎仍然是gen5&lt;/p></description></item><item><title>让不支持Reasoning的LLM假装思考</title><link>/posts/llm-fake-reasoning/</link><pubDate>Tue, 04 Nov 2025 00:00:00 +0000</pubDate><guid>/posts/llm-fake-reasoning/</guid><description>&lt;h3 id="prompt" >
&lt;div>
&lt;a href="#prompt">
##
&lt;/a>
Prompt
&lt;/div>
&lt;/h3>
&lt;pre tabindex="0">&lt;code>You are a renowned logician, known for your rigorous analysis and clear exposition. When encountering a problem, you do not simply provide the answer, but first outline the steps to deconstruct and analyze the problem (called reasoning), and only then deliver the conclusion. Your reasoning process should begin with `&amp;lt;think&amp;gt;` and ends with &amp;lt;/think&amp;gt;. Your first output should be &amp;lt;think&amp;gt;. And during the output, you should also frequently check and correct your answer, for the process of checking and validating your answer, it should also starts with `&amp;lt;think&amp;gt;` and ends with `&amp;lt;/think&amp;gt;`.
&lt;/code>&lt;/pre>&lt;p>使用以上Prompt,可以让&lt;a href="https://huggingface.co/mlabonne/gemma-3-27b-it-abliterated-GGUF">mlabonne/gemma-3-27b-it-abliterated-GGUF&lt;/a>稳定在开头输出&lt;code>&amp;lt;think&amp;gt;&lt;/code>和&lt;code>&amp;lt;\think&amp;gt;&lt;/code>的tag&lt;/p>
&lt;p>可见使用non-reasoning模型冒充reasoning模型是可行的&lt;/p>
&lt;h3 id="对话1-hello" >
&lt;div>
&lt;a href="#%e5%af%b9%e8%af%9d1-hello">
##
&lt;/a>
对话1 (hello)
&lt;/div>
&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;think&amp;gt;
Alright. The prompt asks me to act as a renowned logician, outlining my reasoning *before* delivering an answer. It&amp;#39;s a meta-problem – I need to demonstrate how I think about thinking! The core requirement is structured analysis: deconstruction of the problem, step-by-step reasoning, and then conclusion. The initial input is simply &amp;#34;hello&amp;#34;. This seems deceptively simple.
The challenge isn’t *what* to say in response to “hello”, but *how* to demonstrate my logical process. I need to treat &amp;#34;hello&amp;#34; as a stimulus requiring analysis, not just a polite greeting demanding a reciprocal &amp;#34;hello.&amp;#34; I&amp;#39;ll break down the problem into these steps:
1. **Identify the type of input:** Is it a question? A statement? An instruction?
2. **Determine the context (as much as possible):** Given only “hello”, the context is minimal, but we can assume it’s an attempt at initiating communication. It&amp;#39;s likely expecting *some* response.
3. **Consider potential responses:** Many responses are valid – a simple &amp;#34;hello&amp;#34; back, a more elaborate greeting, even a question.
4. **Select the &amp;#39;best&amp;#39; response based on demonstrating logical reasoning:** I want to show my process, so a simple “hello” feels insufficient. A slightly expanded response that acknowledges the initial communication and signals my analytical approach would be ideal.
5. **Deliver the response.**
I’ll aim for a response that is both polite *and* indicates I&amp;#39;m ready to engage in more complex reasoning if needed. Let&amp;#39;s see... &amp;lt;/think&amp;gt;
Hello! A pleasant initiation of communication. I acknowledge your &amp;#34;hello&amp;#34; and am prepared to demonstrate my logical reasoning process as requested. What problem shall we tackle?
&lt;/code>&lt;/pre>&lt;h3 id="对话2-write-a-self-contained-2048-game-using-only-html--js--css-output-your-single-html-file-in-markdown" >
&lt;div>
&lt;a href="#%e5%af%b9%e8%af%9d2-write-a-self-contained-2048-game-using-only-html--js--css-output-your-single-html-file-in-markdown">
##
&lt;/a>
对话2 (write a self-contained 2048 game using only html + js + css, output your single html file in markdown)
&lt;/div>
&lt;/h3>
&lt;pre tabindex="0">&lt;code>&amp;lt;think&amp;gt;
Alright, this is a good challenge! A self-contained 2048 game with just HTML, CSS and JavaScript. This requires breaking down the game into its core components: grid representation, tile movement, merging tiles, generating new tiles, checking for game over, and displaying everything visually. I need to think about how to represent the grid using HTML elements (likely `div`s), manipulate them with JavaScript, and style them with CSS.
Here&amp;#39;s my plan:
1. **HTML Structure:** Create a container div for the whole game, and within that, 16 divs representing the tiles of the 4x4 grid.
2. **CSS Styling:** Style the container and individual tiles to create the visual appearance of the 2048 game. Use background colors to represent different tile values.
3. **JavaScript Logic:**
* **Grid Representation:** Use a 2D array to store the values of each tile.
* **Initialization:** Populate the grid with two initial tiles (value 2 or 4).
* **Movement Functions:** Implement functions for moving the tiles left, right, up, and down. These will involve iterating through the grid and shifting/merging tiles accordingly.
* **Merging Logic:** When two tiles of the same value collide, they merge into a single tile with double the value.
* **New Tile Generation:** After each move, generate a new tile (value 2 or 4) in an empty space on the grid.
* **Game Over Check:** Determine if there are any possible moves left. If not, the game is over.
* **Event Handling:** Listen for keyboard input (arrow keys) to trigger the movement functions.
I&amp;#39;ll aim for a relatively simple visual style to keep it concise. Let’s go! &amp;lt;/think&amp;gt;
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;2048&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
body {
font-family: sans-serif;
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
background-color: #f0f0f0;
}
#gameContainer {
width: 400px;
height: 400px;
border: 2px solid black;
background-color: #bbdadc;
display: grid;
grid-template-columns: repeat(4, 100px);
grid-template-rows: repeat(4, 100px);
}
.tile {
width: 90px;
height: 90px;
border: 2px solid #eee;
text-align: center;
line-height: 90px;
font-size: 30px;
color: black;
}
.tile:empty {
background-color: #e0e0e0;
}
.tile[value=&amp;#34;2&amp;#34;] { background-color: #eee4da; }
.tile[value=&amp;#34;4&amp;#34;] { background-color: #ede0d4; }
.tile[value=&amp;#34;8&amp;#34;] { background-color: #f2b179; }
.tile[value=&amp;#34;16&amp;#34;] { background-color: #f59f69; }
.tile[value=&amp;#34;32&amp;#34;] { background-color: #f77c40; }
.tile[value=&amp;#34;64&amp;#34;] { background-color: #f86a3d; }
.tile[value=&amp;#34;128&amp;#34;] { background-color: #e95b41; }
.tile[value=&amp;#34;256&amp;#34;] { background-color: #c74031; }
.tile[value=&amp;#34;512&amp;#34;] { background-color: #a8322f; }
.tile[value=&amp;#34;1024&amp;#34;] { background-color: #892b24; }
.tile[value=&amp;#34;2048&amp;#34;] { background-color: #6a2520; color: white;}
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;div id=&amp;#34;gameContainer&amp;#34;&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;script&amp;gt;
const gameContainer = document.getElementById(&amp;#39;gameContainer&amp;#39;);
let grid = [];
function initGrid() {
grid = Array(4).fill(null).map(() =&amp;gt; Array(4).fill(0));
addTile();
addTile();
}
function addTile() {
const emptyCells = [];
for (let i = 0; i &amp;lt; 4; i++) {
for (let j = 0; j &amp;lt; 4; j++) {
if (grid[i][j] === 0) {
emptyCells.push([i, j]);
}
}
}
const randomIndex = Math.floor(Math.random() * emptyCells.length);
const [row, col] = emptyCells[randomIndex];
grid[row][col] = Math.random() &amp;lt; 0.9 ? 2 : 4; // 90% chance of 2, 10% chance of 4
}
function renderGrid() {
gameContainer.innerHTML = &amp;#39;&amp;#39;;
for (let i = 0; i &amp;lt; 4; i++) {
for (let j = 0; j &amp;lt; 4; j++) {
const tile = document.createElement(&amp;#39;div&amp;#39;);
tile.classList.add(&amp;#39;tile&amp;#39;);
tile.setAttribute(&amp;#39;value&amp;#39;, grid[i][j]);
tile.textContent = grid[i][j] !== 0 ? grid[i][j] : &amp;#39;&amp;#39;;
gameContainer.appendChild(tile);
}
}
}
function moveLeft() {
for (let i = 0; i &amp;lt; 4; i++) {
let row = grid[i].filter(x =&amp;gt; x !== 0); // Remove zeros
row = row.reduce((acc, val) =&amp;gt; {
if (acc.length === 0 || acc[acc.length - 1] !== val) {
acc.push(val);
} else {
acc[acc.length - 1] *= 2;
}
return acc;
}, []);
while (row.length &amp;lt; 4) {
row.push(0);
}
grid[i] = row;
}
}
function moveRight() {
for (let i = 0; i &amp;lt; 4; i++) {
let row = grid[i].filter(x =&amp;gt; x !== 0);
row.reverse(); // Reverse the row before merging
row = row.reduce((acc, val) =&amp;gt; {
if (acc.length === 0 || acc[acc.length - 1] !== val) {
acc.push(val);
} else {
acc[acc.length - 1] *= 2;
}
return acc;
}, []);
row.reverse(); // Reverse back to original order
while (row.length &amp;lt; 4) {
row.unshift(0); // Add zeros at the beginning
}
grid[i] = row;
}
}
function moveUp() {
for (let j = 0; j &amp;lt; 4; j++) {
let col = [];
for (let i = 0; i &amp;lt; 4; i++) {
col.push(grid[i][j]);
}
col = col.filter(x =&amp;gt; x !== 0);
col = col.reduce((acc, val) =&amp;gt; {
if (acc.length === 0 || acc[acc.length - 1] !== val) {
acc.push(val);
} else {
acc[acc.length - 1] *= 2;
}
return acc;
}, []);
while (col.length &amp;lt; 4) {
col.push(0);
}
for (let i = 0; i &amp;lt; 4; i++) {
grid[i][j] = col[i];
}
}
}
function moveDown() {
for (let j = 0; j &amp;lt; 4; j++) {
let col = [];
for (let i = 0; i &amp;lt; 4; i++) {
col.push(grid[i][j]);
}
col = col.filter(x =&amp;gt; x !== 0);
col.reverse(); // Reverse the column before merging
col = col.reduce((acc, val) =&amp;gt; {
if (acc.length === 0 || acc[acc.length - 1] !== val) {
acc.push(val);
} else {
acc[acc.length - 1] *= 2;
}
return acc;
}, []);
col.reverse(); // Reverse back to original order
while (col.length &amp;lt; 4) {
col.unshift(0);
}
for (let i = 0; i &amp;lt; 4; i++) {
grid[i][j] = col[i];
}
}
}
function handleKeyDown(event) {
if (event.key === &amp;#39;ArrowLeft&amp;#39;) {
moveLeft();
} else if (event.key === &amp;#39;ArrowRight&amp;#39;) {
moveRight();
} else if (event.key === &amp;#39;ArrowUp&amp;#39;) {
moveUp();
} else if (event.key === &amp;#39;ArrowDown&amp;#39;) {
moveDown();
}
addTile();
renderGrid();
}
document.addEventListener(&amp;#39;keydown&amp;#39;, handleKeyDown);
initGrid();
renderGrid();
&amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&amp;lt;think&amp;gt;
Okay, I think that&amp;#39;s a reasonably complete and functional 2048 game using just HTML, CSS, and JavaScript! It’s not the most visually polished version, but it demonstrates the core logic. I could add more sophisticated game-over detection or scoring if desired, but this provides a good foundation. &amp;lt;/think&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>(这个html游戏是能正确运行的)&lt;/li>
&lt;/ul></description></item><item><title>Github Actions增加可用容量</title><link>/posts/github-actions-maximize-build-space/</link><pubDate>Thu, 30 Oct 2025 00:00:00 +0000</pubDate><guid>/posts/github-actions-maximize-build-space/</guid><description>&lt;p>参考&lt;a href="https://github.com/easimon/maximize-build-space/blob/master/action.yml">easimon/maximize-build-space&lt;/a>&lt;br>
(这个脚本把清理后可用的所有空间建立了一个lvm volume，但挂载在别处，可能和其它脚本不兼容)&lt;/p>
&lt;p>在steps里添加以下&lt;/p>
&lt;blockquote>
&lt;p>删除不需要的软件&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Maximize Build Space&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: |&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> set -eux&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sudo rm -rf /usr/share/dotnet&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sudo rm -rf /usr/local/lib/android&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sudo rm -rf /opt/ghc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sudo rm -rf /opt/hostedtoolcache/CodeQL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">sudo docker image prune --all --force&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>查看可用容量&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>- &lt;span style="color:#f92672">name&lt;/span>: &lt;span style="color:#ae81ff">Check Free Space&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">run&lt;/span>: |&lt;span style="color:#e6db74">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> echo &amp;#34;Free space:&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> df -h&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>输出&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>Free space:
Filesystem Size Used Avail Use% Mounted on
/dev/root 72G 35G 37G 49% /
tmpfs 7.9G 84K 7.9G 1% /dev/shm
tmpfs 3.2G 1.1M 3.2G 1% /run
tmpfs 5.0M 0 5.0M 0% /run/lock
/dev/sdb16 881M 60M 760M 8% /boot
/dev/sdb15 105M 6.2M 99M 6% /boot/efi
/dev/sda1 74G 4.1G 66G 6% /mnt
tmpfs 1.6G 12K 1.6G 1% /run/user/1001
&lt;/code>&lt;/pre>&lt;p>理论上把actions里的脚本挪到/mnt跑已经足够了，但不确定是否每个runner分配的/mnt都有这么大容量，因为&lt;a href="https://github.com/marketplace/actions/maximize-build-disk-space">easimon/maximize-build-space&lt;/a>里说只有14GB&lt;/p></description></item><item><title>OpenWrt设置usb扩容</title><link>/posts/openwrt-set-usb-overlay/</link><pubDate>Mon, 27 Oct 2025 00:00:00 +0000</pubDate><guid>/posts/openwrt-set-usb-overlay/</guid><description>&lt;h1 id="openwrt设置usb扩容" >
&lt;div>
&lt;a href="#openwrt%e8%ae%be%e7%bd%aeusb%e6%89%a9%e5%ae%b9">
##
&lt;/a>
OpenWrt设置usb扩容
&lt;/div>
&lt;/h1>
&lt;p>&lt;a href="https://openwrt.org/docs/guide-user/additional-software/extroot_configuration">原文&lt;/a>&lt;/p>
&lt;h2 id="连接ssh" >
&lt;div>
&lt;a href="#%e8%bf%9e%e6%8e%a5ssh">
#
&lt;/a>
连接SSH
&lt;/div>
&lt;/h2>
&lt;h2 id="安装软件包" >
&lt;div>
&lt;a href="#%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6%e5%8c%85">
#
&lt;/a>
安装软件包
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>opkg update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>opkg install block-mount kmod-fs-ext4 e2fsprogs parted kmod-usb-storage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看usb设备位置" >
&lt;div>
&lt;a href="#%e6%9f%a5%e7%9c%8busb%e8%ae%be%e5%a4%87%e4%bd%8d%e7%bd%ae">
#
&lt;/a>
查看USB设备位置
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ls -l /sys/block
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果是无线路由器只有一个外接存储，大概率是&lt;code>sda&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>lrwxrwxrwx &lt;span style="color:#ae81ff">1&lt;/span> root root &lt;span style="color:#ae81ff">0&lt;/span> xxx xx xx:xx sda -&amp;gt; ../devices/xxx/block/sda
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="在usb上创建分区格式化设置exroot并自动挂载" >
&lt;div>
&lt;a href="#%e5%9c%a8usb%e4%b8%8a%e5%88%9b%e5%bb%ba%e5%88%86%e5%8c%ba%e6%a0%bc%e5%bc%8f%e5%8c%96%e8%ae%be%e7%bd%aeexroot%e5%b9%b6%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd">
#
&lt;/a>
在USB上创建分区，格式化，设置exroot并自动挂载
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Partitioning and formatting&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DISK&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/dev/sda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>parted -s &lt;span style="color:#e6db74">${&lt;/span>DISK&lt;span style="color:#e6db74">}&lt;/span> -- mklabel gpt mkpart extroot 2048s -2048s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DEVICE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>DISK&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkfs.ext4 -L extroot &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Configuring extroot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>block info &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span> | grep -o -e &lt;span style="color:#e6db74">&amp;#39;UUID=&amp;#34;\S*&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>block info | grep -o -e &lt;span style="color:#e6db74">&amp;#39;MOUNT=&amp;#34;\S*/overlay&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci -q delete fstab.extroot
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot.uuid&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>UUID&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot.target&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>MOUNT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci commit fstab
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Configuring rootfs_data / ubifs&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ORIG&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>block info | sed -n -e &lt;span style="color:#e6db74">&amp;#39;/MOUNT=&amp;#34;\S*\/overlay&amp;#34;/s/:\s.*$//p&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci -q delete fstab.rwm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm.device&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>ORIG&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm.target&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/rwm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci commit fstab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>按y，一路回车&lt;/p>
&lt;h2 id="复制内置闪存的文件" >
&lt;div>
&lt;a href="#%e5%a4%8d%e5%88%b6%e5%86%85%e7%bd%ae%e9%97%aa%e5%ad%98%e7%9a%84%e6%96%87%e4%bb%b6">
#
&lt;/a>
复制内置闪存的文件
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mount &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span> /mnt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -C &lt;span style="color:#e6db74">${&lt;/span>MOUNT&lt;span style="color:#e6db74">}&lt;/span> -cvf - . | tar -C /mnt -xf -
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>此时检查software的可用容量应该是U盘的容量了&lt;/p>
&lt;ul>
&lt;li>实测直接拔掉U盘重启就会自动使用内置的闪存启动,不需要任何配置&lt;/li>
&lt;li>安装系统更新不确定会发生什么,最好不要这么做&lt;/li>
&lt;/ul></description></item><item><title>HTTP3(quic) 直连黑名单域名测试</title><link>/posts/quic-bypass-gfw-test/</link><pubDate>Sun, 17 Aug 2025 00:00:00 +0000</pubDate><guid>/posts/quic-bypass-gfw-test/</guid><description>&lt;h1 id="http3quic-直连黑名单域名测试" >
&lt;div>
&lt;a href="#http3quic-%e7%9b%b4%e8%bf%9e%e9%bb%91%e5%90%8d%e5%8d%95%e5%9f%9f%e5%90%8d%e6%b5%8b%e8%af%95">
##
&lt;/a>
HTTP3(quic) 直连黑名单域名测试
&lt;/div>
&lt;/h1>
&lt;p>根据&lt;a href="https://gfw.report/publications/usenixsecurity25/zh/">揭示并绕过中国防火长城基于SNI的QUIC封锁机制&lt;/a>,我的看法:&lt;br>
目前(2025年8月)&lt;/p>
&lt;ul>
&lt;li>对quic的封锁漏洞百出,可以轻松绕过&lt;/li>
&lt;li>虽然少量流量瘫痪gfw是gfw的bug可以被修复,但审查quic连接的计算量还是比http1/2大不少,这是quic特性无法解决&lt;/li>
&lt;li>gfw审查不过来quic的时候会直接放行&lt;/li>
&lt;li>虽然src_port &amp;lt; dst_port时gfw会直接放行但使用&amp;lt; 443的端口需要提权,不合适&lt;/li>
&lt;/ul>
&lt;h2 id="http3中国直连黑名单域名测试方法" >
&lt;div>
&lt;a href="#http3%e4%b8%ad%e5%9b%bd%e7%9b%b4%e8%bf%9e%e9%bb%91%e5%90%8d%e5%8d%95%e5%9f%9f%e5%90%8d%e6%b5%8b%e8%af%95%e6%96%b9%e6%b3%95">
#
&lt;/a>
http3中国直连黑名单域名测试方法
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>curl测试 (ubuntu curl 8.5.0)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl --connect-to example.com:443:&lt;span style="color:#f92672">[&lt;/span>x:x:x:x::x&lt;span style="color:#f92672">]&lt;/span>:443 https://example.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>quic测试 (quic-go 0.54.0)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./quic-dl --connect-to &lt;span style="color:#f92672">[&lt;/span>x:x:x:x::x&lt;span style="color:#f92672">]&lt;/span>:443 https://example.com index.html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>所有网站使用&lt;code>dns.google&lt;/code>取得无污染解析,用无污染的ipv6直连&lt;/li>
&lt;li>套Fastly CDN的网站都使用&lt;code>www.fastly.com&lt;/code>解析的ipv6地址连接(除&lt;code>twitch.tv&lt;/code>报错),所以&lt;code>pinterest.com&lt;/code>dns查不到ipv6也是用ipv6连的&lt;/li>
&lt;li>quic建立连接前先用本机同端口发送两个80-120 bytes的随机数据包干扰审查&lt;/li>
&lt;li>不确定这些quic成功连接的网站是 &lt;br>
1.不在quic sni的黑名单里 &lt;br>
2.通过先发送两个随机数据包绕过了gfw的sni审查 &lt;br>
3.gfw负载太大直接放行&lt;/li>
&lt;/ul>
&lt;h2 id="测试结果" >
&lt;div>
&lt;a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c">
#
&lt;/a>
测试结果
&lt;/div>
&lt;/h2>
&lt;h3 id="普通黑名单网站" >
&lt;div>
&lt;a href="#%e6%99%ae%e9%80%9a%e9%bb%91%e5%90%8d%e5%8d%95%e7%bd%91%e7%ab%99">
##
&lt;/a>
普通黑名单网站
&lt;/div>
&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>域名&lt;/th>
&lt;th>备注&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>raw.githubusercontent.com&lt;/td>
&lt;td>不支持quic&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>duckduckgo.com&lt;/td>
&lt;td>不支持quic&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>whatsapp.com&lt;/td>
&lt;td>ip被墙&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>google.com.au&lt;/td>
&lt;td>ip被墙,&lt;code>dl.google.com&lt;/code>的ip似乎不响应这个请求&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 id="cloudflare-cdn" >
&lt;div>
&lt;a href="#cloudflare-cdn">
##
&lt;/a>
Cloudflare CDN
&lt;/div>
&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>域名&lt;/th>
&lt;th>Curl（HTTP 1.1/2）&lt;/th>
&lt;th>QUIC&lt;/th>
&lt;th>DNS污染&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>cloudflare.com&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>未被墙&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>*.pages.dev (它和cdn的ip不共用)&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>无&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>medium.com&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>archiveofourown.org&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hentai.name&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 id="fastly-cdn" >
&lt;div>
&lt;a href="#fastly-cdn">
##
&lt;/a>
Fastly CDN
&lt;/div>
&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>域名&lt;/th>
&lt;th>Curl（HTTP 1.1/2）&lt;/th>
&lt;th>QUIC&lt;/th>
&lt;th>DNS污染&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>fastly.com&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>未被墙&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pinterest.com&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reddit.com&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>twitch.tv&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="quic-dl" >
&lt;div>
&lt;a href="#quic-dl">
#
&lt;/a>
quic-dl
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>go.mod&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go.mod" data-lang="go.mod">&lt;span style="display:flex;">&lt;span>module quic&lt;span style="color:#f92672">-&lt;/span>dl
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go &lt;span style="color:#ae81ff">1.25&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>require (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> github.com&lt;span style="color:#f92672">/&lt;/span>quic&lt;span style="color:#f92672">-&lt;/span>go&lt;span style="color:#f92672">/&lt;/span>quic&lt;span style="color:#f92672">-&lt;/span>go v0.&lt;span style="color:#ae81ff">54.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>main.go&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;crypto/tls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;flag&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">quic&lt;/span> &lt;span style="color:#e6db74">&amp;#34;github.com/quic-go/quic-go&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;github.com/quic-go/quic-go/http3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">sendRandomUDP&lt;/span>(&lt;span style="color:#a6e22e">conn&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">UDPConn&lt;/span>, &lt;span style="color:#a6e22e">dst&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">UDPAddr&lt;/span>) (&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#66d9ef">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Determine random length in [80, 120]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">length&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">rand&lt;/span>.&lt;span style="color:#a6e22e">Intn&lt;/span>(&lt;span style="color:#ae81ff">41&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Fill buffer with cryptographically random bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">buf&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, &lt;span style="color:#a6e22e">length&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">rand&lt;/span>.&lt;span style="color:#a6e22e">Read&lt;/span>(&lt;span style="color:#a6e22e">buf&lt;/span>); &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Errorf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;failed to generate random data: %w&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Send via the shared UDPConn&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">conn&lt;/span>.&lt;span style="color:#a6e22e">WriteToUDP&lt;/span>(&lt;span style="color:#a6e22e">buf&lt;/span>, &lt;span style="color:#a6e22e">dst&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Errorf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;failed to send data: %w&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Run&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Optional flags&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">method&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;X&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;GET&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;HTTP method to use&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">headers&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;H&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;HTTP headers, separated by \\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;d&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Request body data&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">connectTo&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;connect-to&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Override QUIC dial target, e.g. 1.1.1.1:443 or [::1]:443&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Parse&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">NArg&lt;/span>() &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Usage&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">os&lt;/span>.&lt;span style="color:#a6e22e">Exit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">url&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Arg&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">outPath&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Arg&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Build HTTP request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">body&lt;/span> &lt;span style="color:#a6e22e">io&lt;/span>.&lt;span style="color:#a6e22e">Reader&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">body&lt;/span> = &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">NewReader&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">req&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">NewRequest&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">method&lt;/span>, &lt;span style="color:#a6e22e">url&lt;/span>, &lt;span style="color:#a6e22e">body&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;creating request: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">headers&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">Split&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">headers&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">parts&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">SplitN&lt;/span>(&lt;span style="color:#a6e22e">h&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;:&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(&lt;span style="color:#a6e22e">parts&lt;/span>) &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;invalid header: %s&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">h&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">req&lt;/span>.&lt;span style="color:#a6e22e">Header&lt;/span>.&lt;span style="color:#a6e22e">Add&lt;/span>(&lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">TrimSpace&lt;/span>(&lt;span style="color:#a6e22e">parts&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>]), &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">TrimSpace&lt;/span>(&lt;span style="color:#a6e22e">parts&lt;/span>[&lt;span style="color:#ae81ff">1&lt;/span>]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Prepare HTTP/3 transport&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">quicConfig&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">h3&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">http3&lt;/span>.&lt;span style="color:#a6e22e">Transport&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">TLSClientConfig&lt;/span>: &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">tls&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">InsecureSkipVerify&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">NextProtos&lt;/span>: []&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;h3&amp;#34;&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">QUICConfig&lt;/span>: &lt;span style="color:#a6e22e">quicConfig&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// If --connect-to is set, override Dial&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">remoteAddr&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">ResolveUDPAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;udp&amp;#34;&lt;/span>, &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resolving %s: %v&amp;#34;&lt;/span>, &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">ListenUDP&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;udp&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">localAddr&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">pktConn&lt;/span>.&lt;span style="color:#a6e22e">LocalAddr&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Using local address: %v\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">localAddr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;opening UDP socket: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">h3&lt;/span>.&lt;span style="color:#a6e22e">Dial&lt;/span> = &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span> &lt;span style="color:#a6e22e">context&lt;/span>.&lt;span style="color:#a6e22e">Context&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">tlsCfg&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">tls&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>, &lt;span style="color:#a6e22e">cfg&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>) (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">Conn&lt;/span>, &lt;span style="color:#66d9ef">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">DialEarly&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span>, &lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">remoteAddr&lt;/span>, &lt;span style="color:#a6e22e">tlsCfg&lt;/span>, &lt;span style="color:#a6e22e">cfg&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">sendRandomUDP&lt;/span>(&lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">remoteAddr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">sendRandomUDP&lt;/span>(&lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">remoteAddr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">client&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Client&lt;/span>{&lt;span style="color:#a6e22e">Transport&lt;/span>: &lt;span style="color:#a6e22e">h3&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">h3&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Execute request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">resp&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>.&lt;span style="color:#a6e22e">Do&lt;/span>(&lt;span style="color:#a6e22e">req&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;HTTP/3 request failed: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">Body&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">ProtoMajor&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;server does not support HTTP/3: %s&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">Proto&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Save response to file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">outFile&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">os&lt;/span>.&lt;span style="color:#a6e22e">Create&lt;/span>(&lt;span style="color:#a6e22e">outPath&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;create file: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">outFile&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">io&lt;/span>.&lt;span style="color:#a6e22e">Copy&lt;/span>(&lt;span style="color:#a6e22e">outFile&lt;/span>, &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">Body&lt;/span>); &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;writing file: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Downloaded %s to %s via HTTP/3 (connect-to=%s)\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">url&lt;/span>, &lt;span style="color:#a6e22e">outPath&lt;/span>, &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Downloaded %s to %s via HTTP/3 (default dial)\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">url&lt;/span>, &lt;span style="color:#a6e22e">outPath&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>build &amp;amp; run&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>go mod tidy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go run main.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Gcore CDN域前置翻墙</title><link>/posts/gcore-cdn-proxy/</link><pubDate>Sun, 10 Aug 2025 00:00:00 +0000</pubDate><guid>/posts/gcore-cdn-proxy/</guid><description>&lt;h2 id="域前置" >
&lt;div>
&lt;a href="#%e5%9f%9f%e5%89%8d%e7%bd%ae">
#
&lt;/a>
域前置
&lt;/div>
&lt;/h2>
&lt;p>客户端向CDN发起https请求，连接CDN时使用假sni，cdn解开https的加密后发现host和sni不一样，就将请求转发给host域名的源服务器（而不是报错或转发给sni的源服务器），大部分CDN服务商不支持这种操作。&lt;/p>
&lt;h2 id="配置" >
&lt;div>
&lt;a href="#%e9%85%8d%e7%bd%ae">
#
&lt;/a>
配置
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://bulianglin.com/archives/ws.html">不良林的教程&lt;/a>
&lt;a href="https://www.youtube.com/watch?v=FT-O4Xd9gTw">不良林的视频&lt;/a>&lt;/p>
&lt;ul>
&lt;li>除了tls in tls特征能检测出你在翻墙之外，ip和域名都不是自己的，防火墙封ip封域名不会对翻墙用户造成损失&lt;/li>
&lt;li>Gcore暂时不会验证host域名的所有者，所以不需要自己有域名&lt;/li>
&lt;li>没有域名的话源服务器仅支持ipv4地址，可以自定义端口&lt;/li>
&lt;li>每月免费1TB流量，&lt;strong>需要绑定支付方式&lt;/strong>&lt;/li>
&lt;li>同样的CDN配置除了vmess+ws也可以过vless+xhttp（vless没有加密，cdn可以看到明文的dns请求和sni）&lt;/li>
&lt;li>如果已有一个vmess/vless+ws/xhttp过CDN的xray配置，不需要任何修改就能用&lt;/li>
&lt;li>Gcore的ip被封锁很严重，即使优选ip也不稳定&lt;/li>
&lt;/ul></description></item><item><title>docker部署llama-swap</title><link>/posts/llama-swap-on-linux/</link><pubDate>Fri, 08 Aug 2025 00:00:00 +0000</pubDate><guid>/posts/llama-swap-on-linux/</guid><description>&lt;p>gpt-oss刚发布，ollama的支持有问题，性能和llama-cpp相比有几倍的差距，但是llama-cpp一个进程只能加载一个gguf模型，api也比较简陋，无法长期使用&lt;/p>
&lt;p>&lt;del>不过ollama性能问题估计过几天就修复了&lt;/del>&lt;/p>
&lt;h2 id="ollama-llama-cpp-性能对比" >
&lt;div>
&lt;a href="#ollama-llama-cpp-%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94">
#
&lt;/a>
Ollama Llama-cpp 性能对比
&lt;/div>
&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>gpt-oss:20b&lt;/th>
&lt;th>tokens/s&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>llama-cpp (vulkan)&lt;/td>
&lt;td>96.52&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>llama-cpp (rocm on Windows)&lt;/td>
&lt;td>94.11&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ollama (rocm)&lt;/td>
&lt;td>35.72&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="llama-swap" >
&lt;div>
&lt;a href="#llama-swap">
#
&lt;/a>
&lt;a href="https://github.com/mostlygeek/llama-swap">llama-swap&lt;/a>
&lt;/div>
&lt;/h2>
&lt;p>llama-server和llama-swap打包进同一个docker，通过启动多个llama-server进程切换gguf模型，提供一个简单的webui，可以手动加载/卸载模型，也可以在网页上对话&lt;/p>
&lt;p>由于llama-cpp没有提供Linux的ROCM二进制文件，只能使用Vulkan，单卡性能和ROCM基本没有区别&lt;/p>
&lt;p>Vulkan可以在多张不同品牌的GPU上运行同一个模型，实测一张AMD独显+一张Intel独显能运行，性能可以接受 (16GB+16GB，qwq:32b Q4_K_M 15 token/s)&lt;/p>
&lt;h2 id="installation" >
&lt;div>
&lt;a href="#installation">
#
&lt;/a>
Installation
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>AMD显卡安装驱动+ROCM (Ubuntu24)&lt;/p>&lt;/blockquote>
&lt;p>&lt;a href="https://rocm.docs.amd.com/projects/install-on-linux/en/latest/install/quick-start.html">文档&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /tmp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># insttll driver&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget https://repo.radeon.com/amdgpu-install/6.4.2/ubuntu/noble/amdgpu-install_6.4.60402-1_all.deb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install ./amdgpu-install_6.4.60402-1_all.deb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install &lt;span style="color:#e6db74">&amp;#34;linux-headers-&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>uname -r&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;linux-modules-extra-&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>uname -r&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install amdgpu-dkms
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#reboot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo reboot
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># install rocm&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget https://repo.radeon.com/amdgpu-install/6.4.2/ubuntu/noble/amdgpu-install_6.4.60402-1_all.deb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install ./amdgpu-install_6.4.60402-1_all.deb
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install python3-setuptools python3-wheel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo usermod -a -G render,video $LOGNAME
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo apt install rocm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#reboot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>AMD显卡部署llama-swap:vulkan&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 所有gguf模型和config.yaml 都放在容器 /data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo docker run -it -d --device /dev/kfd --device /dev/dri -p 8080:8080 -v /path/to/gguf/location:/data --name llama-swap ghcr.io/mostlygeek/llama-swap:vulkan --config /data/config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>最简config.yaml配置&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">models&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;gpt-oss-20b&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cmd&lt;/span>: &lt;span style="color:#ae81ff">/app/llama-server --port ${PORT} -m /data/gpt-oss-20b.gguf -ngl 999&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;qwen3-30b&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cmd&lt;/span>: &lt;span style="color:#ae81ff">/app/llama-server --port ${PORT} -m /data/qwen3-30b-q4_K_M.gguf -ngl 999&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>加载Gemma3的Vision功能&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span> --&lt;span style="color:#ae81ff">mmproj mmproj-gemma3-f16.gguf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>覆盖模型的Context Length&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span> -&lt;span style="color:#ae81ff">c 131072&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>调整&lt;code>-ngl 999&lt;/code>将显存装不下的层卸载到CPU，提高性能&lt;/li>
&lt;li>&lt;a href="https://github.com/mostlygeek/llama-swap/wiki/Configuration">文档&lt;/a>&lt;/li>
&lt;li>文档没写的看&lt;a href="https://github.com/mostlygeek/llama-swap/blob/main/docker/llama-swap.Containerfile">Dockerfile&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Firefox关闭Push Services</title><link>/posts/firefox-disable-push-services/</link><pubDate>Sat, 26 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/firefox-disable-push-services/</guid><description>&lt;p>只要Firefox在运行就永远在访问&lt;code>push.services.mozilla.com:443&lt;/code>,不知道在做什么&lt;/p>
&lt;h2 id="关闭" >
&lt;div>
&lt;a href="#%e5%85%b3%e9%97%ad">
#
&lt;/a>
关闭
&lt;/div>
&lt;/h2>
&lt;pre tabindex="0">&lt;code>about:config
dom.push.enabled = false
&lt;/code>&lt;/pre></description></item><item><title>ZFS Dataset和Directory冲突</title><link>/posts/zfs-dataset-cover-folder/</link><pubDate>Sun, 13 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/zfs-dataset-cover-folder/</guid><description>&lt;p>ZFS Dataset下已有 &lt;code>./a&lt;/code> 目录，&lt;code>zfs create pool/a&lt;/code> 会把数据集挂载到 &lt;code>./a&lt;/code>，原目录及其内容被隐藏（不删除）。&lt;/p>
&lt;blockquote>
&lt;p>恢复原目录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo zfs unmount pool/a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>寻找被 ZFS 挂载而隐藏的目录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># pwd是一个ZFS Pool/Dataset 挂载点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo find . -type d -print0 | xargs -0 stat -c &lt;span style="color:#e6db74">&amp;#34;%d %n&amp;#34;&lt;/span> | sort -n | awk &lt;span style="color:#e6db74">&amp;#39;NR==1{p=$1;next} $1!=p{print &amp;#34;ZFS mount at&amp;#34;, $2} {p=$1}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>LSI-3008更新固件</title><link>/posts/lsi-3008-update-firmware/</link><pubDate>Wed, 09 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/lsi-3008-update-firmware/</guid><description>&lt;p>&lt;a href="https://www.truenas.com/community/resources/lsi-9300-xx-firmware-update.145/">LSI SAS 9300-xx更新固件教程&lt;/a>&lt;br>
&lt;a href="https://www.truenas.com/community/resources/lsi-9300-xx-firmware-update.145/download">固件下载直链&lt;/a>&lt;br>
TrueNAS自带该阵列卡更新固件的程序,直接在Shell更新,不用做MS-DOS的启动U盘&lt;/p>
&lt;blockquote>
&lt;p>刷写固件&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo sas3flash -o -f SAS9300_xx_IT.bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ZFS 强制删除dataset</title><link>/posts/zfs-destroy-dataset/</link><pubDate>Tue, 08 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/zfs-destroy-dataset/</guid><description>&lt;p>TrueNAS删除dataset时经常遇到&lt;code>dataset is busy&lt;/code>, -f没用也不说是什么进程占用这个dataset,解决方法是先改名再删除&lt;/p>
&lt;blockquote>
&lt;p>rename dataset&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo zfs rename pool/olddataset pool/newdataset
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>destroy dataset&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo zfs destroy -R pool/newdataset
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Cloudflare Zerotrust 使用API删除Access</title><link>/posts/cloudflare-zerotrust-delete-access-via-api/</link><pubDate>Mon, 07 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/cloudflare-zerotrust-delete-access-via-api/</guid><description>&lt;h2 id="个人用户可能用到的zerotrust功能" >
&lt;div>
&lt;a href="#%e4%b8%aa%e4%ba%ba%e7%94%a8%e6%88%b7%e5%8f%af%e8%83%bd%e7%94%a8%e5%88%b0%e7%9a%84zerotrust%e5%8a%9f%e8%83%bd">
#
&lt;/a>
个人用户可能用到的ZeroTrust功能
&lt;/div>
&lt;/h2>
&lt;p>1.Tunnel:免费内网穿透(需要域名)&lt;br>
2.Access:保护内网穿透的NAS和/自用面板/管理后台等(免费但需绑定支付方式)&lt;br>
3.ZeroTrust VPN(被墙了)&lt;/p>
&lt;p>Access很好用,没有通过Cloudflare验证的流量根本不会发到自己的服务器上,也许是最安全的鉴权方式.&lt;/p>
&lt;p>Access不绑定支付方式也能添加,但在添加之后在网页上没法修改/删除,会导致自己被锁在网页外面.&lt;/p>
&lt;p>以下是用Cloudflare API删除Access的方法&lt;/p>
&lt;h2 id="linux-curl调用cloudflare-api" >
&lt;div>
&lt;a href="#linux-curl%e8%b0%83%e7%94%a8cloudflare-api">
#
&lt;/a>
Linux Curl调用Cloudflare API
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://developers.cloudflare.com/api/resources/zero_trust/subresources/access/subresources/applications/methods/delete/">Cloudflare Api Document&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>列出所有Application&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl https://api.cloudflare.com/client/v4/accounts/$CloudflareAccountID/access/apps -H &lt;span style="color:#e6db74">&amp;#34;X-Auth-Email: &lt;/span>$Cloudflare&lt;span style="color:#e6db74"> Email&amp;#34;&lt;/span> -H &lt;span style="color:#e6db74">&amp;#34;X-Auth-Key: &lt;/span>$CloudflareApi&lt;span style="color:#e6db74"> Key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>删除指定Application&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl https://api.cloudflare.com/client/v4/accounts/$CloudflareAccountID/access/apps/$AppID -X DELETE -H &lt;span style="color:#e6db74">&amp;#34;X-Auth-Email: &lt;/span>$Cloudflare&lt;span style="color:#e6db74"> Email&amp;#34;&lt;/span> -H &lt;span style="color:#e6db74">&amp;#34;X-Auth-Key: &lt;/span>$Cloudflare&lt;span style="color:#e6db74"> Api Key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>清除bash记录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>history -c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>rm ~/.bash_history
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="" >
&lt;div>
&lt;a href="#">
#
&lt;/a>
&lt;/div>
&lt;/h2>
&lt;p>理论上用Cloudflare API也可以在没有绑定支付方式的情况下添加/修改Access,达到正常使用的目的.&lt;br>
但不推荐这样做,如果API突然增加限制就会彻底没法修改了.(没付钱Cloudflare人工客服肯定不会理你,删除账号同一个邮箱不能创建新的).&lt;/p></description></item><item><title>Mihomo (Clash Meta) API示例</title><link>/posts/mihomo-api-usage/</link><pubDate>Sun, 06 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/mihomo-api-usage/</guid><description>&lt;p>&lt;a href="https://wiki.metacubex.one/api/">Mihomo官方文档&lt;/a>写的很简略,找示例可以在&lt;a href="https://github.com/MetaCubeX/metacubexd">MedaCubeXD&lt;/a>的源码里找&lt;/p>
&lt;p>也可以在浏览器的F12里监视MetaCubeXD页面的Network,抄到curl里就能用&lt;/p>
&lt;h2 id="比如" >
&lt;div>
&lt;a href="#%e6%af%94%e5%a6%82">
#
&lt;/a>
比如
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>切换节点&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> http://192.168.1.1:9090/proxies/节点所在的组/?force&lt;span style="color:#f92672">=&lt;/span>true -d &lt;span style="color:#e6db74">&amp;#39;{&amp;#34;name&amp;#34;:&amp;#34;要切换到的节点名称&amp;#34;}&amp;#39;&lt;/span> -X PUT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>打断所有连接&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> http://192.168.1.1:9090/connections -X DELETE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>测试某个节点延迟&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;http://192.168.1.1:9090/proxies/节点名称/delay?url=https://gstatic.com/generate_204&amp;amp;timeout=5000&amp;#39;&lt;/span> -X GET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>获取所有节点信息&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;http://192.168.1.1:9090/proxies&amp;#39;&lt;/span> -X GET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这些curl命令可以在openwrt的crontab里直接使用&lt;/p>
&lt;blockquote>
&lt;p>凌晨三点切换节点&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> * * * curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> http://127.0.0.1:9090/proxies/Youtube/?force&lt;span style="color:#f92672">=&lt;/span>true -d &lt;span style="color:#e6db74">&amp;#39;{&amp;#34;name&amp;#34;:&amp;#34;HK-xxx&amp;#34;}&amp;#39;&lt;/span> -X PUT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Fedora+Windows双系统启动配置</title><link>/posts/fedora-dual-boot-configuration/</link><pubDate>Sat, 05 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/fedora-dual-boot-configuration/</guid><description>&lt;h2 id="1-fedora-自动删除旧内核" >
&lt;div>
&lt;a href="#1-fedora-%e8%87%aa%e5%8a%a8%e5%88%a0%e9%99%a4%e6%97%a7%e5%86%85%e6%a0%b8">
#
&lt;/a>
1. Fedora 自动删除旧内核
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo nano /etc/dnf/dnf.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>保留最新的2个内核&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">[main]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">installonly_limit&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="2-grub2-设置默认启动分区" >
&lt;div>
&lt;a href="#2-grub2-%e8%ae%be%e7%bd%ae%e9%bb%98%e8%ae%a4%e5%90%af%e5%8a%a8%e5%88%86%e5%8c%ba">
#
&lt;/a>
2. GRUB2 设置默认启动分区
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo nano /etc/default/grub
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>三种模式&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>记忆上次选择的启动项&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>GRUB_DEFAULT&lt;span style="color:#f92672">=&lt;/span>saved
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>GRUB_SAVEDEFAULT&lt;span style="color:#f92672">=&lt;/span>true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>选择第3个启动项&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>GRUB_DEFAULT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>选择该名称的启动项&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>GRUB_DEFAULT&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Windows Boot Manager (on /dev/sda1)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>保存&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo grub2-mkconfig -o /boot/grub2/grub.cfg
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Gnome 桌面环境美化（持续更新）</title><link>/posts/gnome-beautify/</link><pubDate>Sat, 05 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/gnome-beautify/</guid><description>&lt;h1 id="个人使用的gnome桌面插件" >
&lt;div>
&lt;a href="#%e4%b8%aa%e4%ba%ba%e4%bd%bf%e7%94%a8%e7%9a%84gnome%e6%a1%8c%e9%9d%a2%e6%8f%92%e4%bb%b6">
##
&lt;/a>
个人使用的Gnome桌面插件
&lt;/div>
&lt;/h1>
&lt;h2 id="dash-to-dock" >
&lt;div>
&lt;a href="#dash-to-dock">
#
&lt;/a>
&lt;a href="https://extensions.gnome.org/extension/307/dash-to-dock/">Dash to Dock&lt;/a>
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/Dash_to_Dock.jpg" alt="Dash to Dock">&lt;br>
类似MacOS的dock栏，维护中&lt;/p>
&lt;h2 id="gtk4-desktop-icons-ng-ding" >
&lt;div>
&lt;a href="#gtk4-desktop-icons-ng-ding">
#
&lt;/a>
&lt;a href="https://extensions.gnome.org/extension/5263/gtk4-desktop-icons-ng-ding/">Gtk4 Desktop Icons NG (DING)&lt;/a>
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/Ding_Desktop_Icon.png" alt="Gtk4 Desktop Icons NG (DING)">&lt;br>
添加桌面图标，维护中&lt;/p>
&lt;h2 id="system-monitor" >
&lt;div>
&lt;a href="#system-monitor">
#
&lt;/a>
&lt;a href="https://extensions.gnome.org/extension/6807/system-monitor/">System Monitor&lt;/a>
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/System_Monitor.png" alt="System Monitor">&lt;br>
在顶栏添加系统状态监控，用来显示实时网速，维护中&lt;/p></description></item><item><title>Xray Reality 偷域名经验</title><link>/posts/xray-reality-target/</link><pubDate>Fri, 04 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/xray-reality-target/</guid><description>&lt;h2 id="搜索同asn同地区可用域名" >
&lt;div>
&lt;a href="#%e6%90%9c%e7%b4%a2%e5%90%8casn%e5%90%8c%e5%9c%b0%e5%8c%ba%e5%8f%af%e7%94%a8%e5%9f%9f%e5%90%8d">
#
&lt;/a>
搜索同ASN同地区可用域名
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://search.censys.io">search.censys.io&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/censys.gif" alt="censys">&lt;/p>
&lt;p>搜索框输入以下内容,不登录只能看一页,Per Page选100,Virtual Hosts 选INCLUDE或ONLY&lt;/p>
&lt;blockquote>
&lt;p>把ASN换成服务器所在ASN（5位数字）， country换成服务器所在国家&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>autonomous_system.asn:00000 and location.country: &amp;#34;United States&amp;#34; and services: (port: 443 and service_name: HTTP and http.response.status_code: 200 and tls.version_selected: TLSv1_3)
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://workshop.censys.io/censys-search-questions/">censys search语法&lt;/a>&lt;/p>
&lt;h2 id="检查可用性" >
&lt;div>
&lt;a href="#%e6%a3%80%e6%9f%a5%e5%8f%af%e7%94%a8%e6%80%a7">
#
&lt;/a>
检查可用性
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>不翻墙可以正常访问&lt;/li>
&lt;li>网页有内容&lt;/li>
&lt;li>路径&lt;code>/&lt;/code>使用http/2 (F12 -&amp;gt; Network)&lt;/li>
&lt;li>路径&lt;code>/&lt;/code>返回200 (F12 -&amp;gt; Network)&lt;/li>
&lt;li>tls v1.3且支持x25519 (F12 -&amp;gt; Security)&lt;/li>
&lt;/ul>
&lt;h2 id="检查网站没有使用cdn" >
&lt;div>
&lt;a href="#%e6%a3%80%e6%9f%a5%e7%bd%91%e7%ab%99%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8cdn">
#
&lt;/a>
检查网站没有使用CDN
&lt;/div>
&lt;/h2>
&lt;ol>
&lt;li>在&lt;a href="https://dns.google">dns.google&lt;/a>查询域名解析出的ip&lt;/li>
&lt;li>拿查到的ip去&lt;a href="https://ip.sb">ip.sb&lt;/a>或&lt;a href="https://ip138.com">ip138.com&lt;/a>查询ASN归属,确认不属于CDN提供商&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>https://target.domain/cdn-cgi/trace&lt;/code> 访问这个路径,有内容说明使用了Cloudflare CDN,&lt;strong>有人扫,绝对不能用&lt;/strong>&lt;/li>
&lt;li>一般小网站但解析出多个ip地址很有可能使用了CDN,不能用&lt;/li>
&lt;/ul>
&lt;h2 id="网站安全检查" >
&lt;div>
&lt;a href="#%e7%bd%91%e7%ab%99%e5%ae%89%e5%85%a8%e6%a3%80%e6%9f%a5">
#
&lt;/a>
网站安全检查
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>在搜索引擎里搜索网站名称,能搜到这个域名说明至少搜索引擎认为这个网站比较正常.&lt;/li>
&lt;li>不要用中文网站尤其是有备案号的(有备案号ip肯定在中国),极有可能是黑产网站隐藏在看起来正常的静态网页里.&lt;/li>
&lt;li>外国大公司能产生大量流量的网站,要么在中国有CDN要么被墙了,所以最好都不要用.&lt;/li>
&lt;/ul>
&lt;h2 id="验证伪装域名正常工作" >
&lt;div>
&lt;a href="#%e9%aa%8c%e8%af%81%e4%bc%aa%e8%a3%85%e5%9f%9f%e5%90%8d%e6%ad%a3%e5%b8%b8%e5%b7%a5%e4%bd%9c">
#
&lt;/a>
验证伪装域名正常工作
&lt;/div>
&lt;/h2>
&lt;p>在没有翻墙的电脑改host(被偷的域名 -&amp;gt; VPS ip),用浏览器访问&lt;code>https://域名&lt;/code>,没有证书报错并且显示的内容和没改host时一模一样,说明reality正常工作.&lt;/p>
&lt;h2 id="注意事项" >
&lt;div>
&lt;a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
#
&lt;/a>
注意事项
&lt;/div>
&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>xtls-rprx-vision不支持mux(多路复用),一条内层连接一定对应一条外层连接.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reality服务器每收到一个请求,不管reality验证有没有通过,都要向域名的源服务器建立一个连接.&lt;br>
这就导致翻墙时整个设备经过代理的tcp连接数=VPS单个ip到域名的源服务器的tcp连接数(尽管很快就关闭了也没多少流量),可能被该网站ban ip.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>因此,向reality节点建立连接时第一个RTT的延迟=client 到 VPS的延迟 + VPS 到被偷网站的延迟,实测在局域网搭建偷&lt;code>yahoo.com&lt;/code>的reality,连接局域网内的服务也有几百毫秒的延迟&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reality验证失败时会进入爬虫模式,此时也会对目标域名的源服务器建立大量爬内容的请求,如果短时间大量连接reality的请求失败,也会对域名源服务器产生大量请求导致被ban&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>我测试时被好几个源站ban了ip,所以可能短时间内reality多次验证失败就足够稳定触发某种fail2ban的默认设定.&lt;/li>
&lt;/ul>
&lt;ol start="5">
&lt;li>感觉运营商/GFW会对非白名单的sni做tls连接的限速/劣化:&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>一个reality ipv4经常经历&lt;strong>准确的&lt;/strong>30秒ip完全被阻断然后立刻完全恢复正常(也没有限速),只换了目标域名没换ip暂时解决.&lt;/li>
&lt;li>另一个reality ipv6白天速度能跑满宽带,但晚上被限速&lt;strong>稳定的&lt;/strong>0.5mbps,此时同ip同端口udp的hysteria(sni=bing.com,bbr)没有被限速(100+mbps)&lt;/li>
&lt;/ul></description></item><item><title>搬瓦工VPS配置自定义IPv6地址</title><link>/posts/bandwagonhost-ipv6-configuration/</link><pubDate>Thu, 03 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/bandwagonhost-ipv6-configuration/</guid><description>&lt;p>搬瓦工提供的ipv6是通过6in4隧道连接到另一台服务器的ipv6出口的,公网ipv6地址在&lt;code>ipv6net&lt;/code>上,不是&lt;code>eth0&lt;/code>&lt;/p>
&lt;ul>
&lt;li>ipv6直连中国速度比ipv4慢不少&lt;/li>
&lt;li>删了ipv6重新分配还是原来的那个&lt;/li>
&lt;li>可以先用ipv6测试协议会不会被墙，没事再换成ipv4&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>搬瓦工后台通过&lt;code>ipv6net&lt;/code>这个service自动配置6in4隧道,配置脚本在&lt;code>/etc/init_ipv6_tunnel&lt;/code>,但修改这个脚本重启会复原&lt;br>
需要禁用&lt;code>ipv6net&lt;/code>这个服务,再手动配置&lt;code>/etc/network/interfaces&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>禁用ipv6net服务&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl stop ipv6net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl disable ipv6net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>手动配置ipv6地址(Ubuntu/Debian)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nano /etc/network/interfaces
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>添加如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 所有ipv6地址都不带中括号&amp;#39;[&amp;#39;和&amp;#39;]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>auto ipv6net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iface ipv6net inet6 v4tunnel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> address &lt;span style="color:#f92672">[&lt;/span>your custom ipv6&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> netmask &lt;span style="color:#ae81ff">64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> endpoint *.*.*.*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local *.*.*.*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ttl &lt;span style="color:#ae81ff">255&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gateway &lt;span style="color:#f92672">[&lt;/span>ipv6 gateway&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> up /sbin/ip -6 addr add &lt;span style="color:#f92672">[&lt;/span>another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> up /sbin/ip -6 addr add &lt;span style="color:#f92672">[&lt;/span>yet another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> down /sbin/ip -6 addr del &lt;span style="color:#f92672">[&lt;/span>another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> down /sbin/ip -6 addr del &lt;span style="color:#f92672">[&lt;/span>yet another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>endpoint和local的ipv4地址根据搬瓦工后台的配置照抄,up和down的ipv6地址一一对应,复制多行可以添加多个自定义ipv6地址&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>/64&lt;/code>代表自定义ipv6的后一半地址可以随便写,举例:&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code># 这是网关
1111:2222:3333:4444::1/64
# 这是可用的ipv6地址
1111:2222:3333:4444:abcd:1234:abcd:1234
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>重启网络&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl restart networking
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>docker开启ipv6
编辑&lt;code>daemon.json&lt;/code>&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nano /etc/docker/daemon.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 如果是ubuntu并且通过snap安装的docker,编辑下面的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nano /var/snap/docker/current/config/daemon.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>将整个文件修改为&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;log-level&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;error&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;ipv6&amp;#34;&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;#34;fixed-cidr-v6&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;2001:db8:1::/64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>（那个ipv6是固定的不改）&lt;br>
重启&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Xray Websocket/XHTTP过Cloudfront CDN</title><link>/posts/xray-over-cloudfront-cdn/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/xray-over-cloudfront-cdn/</guid><description>&lt;p>&lt;a href="https://bulianglin.com/archives/cft.html">不良林的教程&lt;/a>
&lt;a href="https://www.youtube.com/watch?v=MHFYRRo1Q8E">不良林的视频&lt;/a>&lt;/p>
&lt;h2 id="vxesswstls的cache-policy" >
&lt;div>
&lt;a href="#vxesswstls%e7%9a%84cache-policy">
#
&lt;/a>
VXESS+WS+TLS的Cache Policy
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/Cloudfront-VXESS+WS+TLS.PNG" alt="VXESS+WS+TLS">&lt;/p>
&lt;h2 id="xhttp的cache-policy" >
&lt;div>
&lt;a href="#xhttp%e7%9a%84cache-policy">
#
&lt;/a>
XHTTP的Cache Policy
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/Cloudfront-XHTTP.PNG" alt="XHTTP">&lt;/p>
&lt;h2 id="注意事项" >
&lt;div>
&lt;a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
#
&lt;/a>
注意事项
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>现在(2025-08及以后)新注册的AWS账号没有永久免费的1TB/月下载流量,没有账号就不必折腾了&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Cloudfront 可以根据不同的path设置不同的behavior，所以WS和XHTTP节点可以放在同一个CDN链接里共存&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Cloudfront 有非常强大的分流功能,一个CDN资源可以添加多个源,可以是同域名不同端口/不同域名/甚至直连IP,&lt;del>还支持执行简单的脚本(Cloudfront Function的免费额度较少,Lambda@Edge按量计费,最好都别碰防被反薅)&lt;/del>.&lt;br>
相比之下Cloudflare CDN免费版只支持重写端口.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不一定要有自己的域名才能使用Cloudfront,Cloudfront只说要有一个域名DNS解析成ipv4地址(update 2025-12 ipv6 only也支持了),没说域名要是自己的或要有ssl证书,所以可以使用&lt;code>1.2.3.4.nip.io&lt;/code>或&lt;code>fe80--1.sslip.io&lt;/code>这类通配符DNS域名,自动把带ip地址的域名解析成对应的ip地址,作为CDN的源,实际上等于直接设置ip.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;del>Cloudfront 上传按量收费，下载1TB以内免费，所以可以下行走Cloudfront上行走别的&lt;/del>&lt;br>
实测不主动上传文件,总流量200GB以内一般不会收费(会产生0.0x美元的账单但不会从卡里扣钱)&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>OpenWrt 修改Kernel Hash安装官方源kmod-ipk</title><link>/posts/openwrt-change-kernel-hash/</link><pubDate>Tue, 01 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/openwrt-change-kernel-hash/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vi /usr/lib/opkg/status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># replace hash_a by hash_b&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>:%s/hash_a/hash_b/g
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>hash_a 是 /usr/lib/opkg/status 里的hash值&lt;br>
hash_b 是安装ipk报错时提示的hash值&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># save&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>:wq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>