<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>软路由 on 0x2196f3's blog</title><link>/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/</link><description>0x2196f3's blog (软路由)</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Mon, 27 Oct 2025 00:00:00 +0000</lastBuildDate><atom:link href="/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/index.xml" rel="self" type="application/rss+xml"/><item><title>OpenWrt扩容</title><link>/posts/openwrt-expand-root/</link><pubDate>Mon, 27 Oct 2025 00:00:00 +0000</pubDate><guid>/posts/openwrt-expand-root/</guid><description>&lt;h1 id="openwrt扩容" >
&lt;div>
&lt;a href="#openwrt%e6%89%a9%e5%ae%b9">
##
&lt;/a>
OpenWrt扩容
&lt;/div>
&lt;/h1>
&lt;p>原文: &lt;a href="https://openwrt.org/docs/guide-user/advanced/expand_root">Expanding root partition and filesystem&lt;/a>&lt;/p>
&lt;ul>
&lt;li>很多教程说扩容仅支持EXT4,不支持SquashFS,实测OpenWRT24.10 SquashFS可以扩容&lt;/li>
&lt;li>很多教程说扩容后无法更新系统,虽然原文说可以在更新后自动把扩容脚本再执行一遍,但没说原来的数据会怎么样.我没试过,最好不要更新系统.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cd /tmp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Install packages&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>opkg update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>opkg install parted losetup resize2fs blkid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Download expand-root.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget -U &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> -O expand-root.sh &lt;span style="color:#e6db74">&amp;#34;https://openwrt.org/_export/code/docs/guide-user/advanced/expand_root?codeblock=0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Source the script (creates /etc/uci-defaults/70-rootpt-resize and /etc/uci-defaults/80-rootpt-resize, and adds them to /etc/sysupgrade.conf so they will be re-run after a sysupgrade)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>. ./expand-root.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># Resize root partition and filesystem (will resize partiton, reboot resize filesystem, and reboot again)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sh /etc/uci-defaults/70-rootpt-resize
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>这段脚本做了什么?&lt;/p>&lt;/blockquote>
&lt;ol start="0">
&lt;li>扩容&lt;/li>
&lt;li>将扩容脚本写入到&lt;code>/etc/uci-defaults/70-rootpt-resize&lt;/code>和&lt;code>/etc/uci-defaults/80-rootfs-resize&lt;/code>&lt;/li>
&lt;li>自动设置在系统更新后保留这两个脚本(luci界面&lt;code>System -&amp;gt; Backup / Flash Firmware / Configuration&lt;/code>可查)&lt;/li>
&lt;li>但没有将这两个脚本写入&lt;code>/etc/sysupgrade.conf&lt;/code>(这个文件甚至不存在).&lt;/li>
&lt;/ol>
&lt;p>所以默认自动更新后应该不会扩容&lt;/p></description></item><item><title>OpenWrt设置usb扩容</title><link>/posts/openwrt-set-usb-overlay/</link><pubDate>Mon, 27 Oct 2025 00:00:00 +0000</pubDate><guid>/posts/openwrt-set-usb-overlay/</guid><description>&lt;h1 id="openwrt设置usb扩容" >
&lt;div>
&lt;a href="#openwrt%e8%ae%be%e7%bd%aeusb%e6%89%a9%e5%ae%b9">
##
&lt;/a>
OpenWrt设置usb扩容
&lt;/div>
&lt;/h1>
&lt;p>&lt;a href="https://openwrt.org/docs/guide-user/additional-software/extroot_configuration">原文&lt;/a>&lt;/p>
&lt;h2 id="连接ssh" >
&lt;div>
&lt;a href="#%e8%bf%9e%e6%8e%a5ssh">
#
&lt;/a>
连接SSH
&lt;/div>
&lt;/h2>
&lt;h2 id="安装软件包" >
&lt;div>
&lt;a href="#%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6%e5%8c%85">
#
&lt;/a>
安装软件包
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>opkg update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>opkg install block-mount kmod-fs-ext4 e2fsprogs parted kmod-usb-storage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看usb设备位置" >
&lt;div>
&lt;a href="#%e6%9f%a5%e7%9c%8busb%e8%ae%be%e5%a4%87%e4%bd%8d%e7%bd%ae">
#
&lt;/a>
查看USB设备位置
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ls -l /sys/block
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果是无线路由器只有一个外接存储，大概率是&lt;code>sda&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>lrwxrwxrwx &lt;span style="color:#ae81ff">1&lt;/span> root root &lt;span style="color:#ae81ff">0&lt;/span> xxx xx xx:xx sda -&amp;gt; ../devices/xxx/block/sda
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="在usb上创建分区格式化设置exroot并自动挂载" >
&lt;div>
&lt;a href="#%e5%9c%a8usb%e4%b8%8a%e5%88%9b%e5%bb%ba%e5%88%86%e5%8c%ba%e6%a0%bc%e5%bc%8f%e5%8c%96%e8%ae%be%e7%bd%aeexroot%e5%b9%b6%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd">
#
&lt;/a>
在USB上创建分区，格式化，设置exroot并自动挂载
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Partitioning and formatting&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DISK&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/dev/sda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>parted -s &lt;span style="color:#e6db74">${&lt;/span>DISK&lt;span style="color:#e6db74">}&lt;/span> -- mklabel gpt mkpart extroot 2048s -2048s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DEVICE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>DISK&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkfs.ext4 -L extroot &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Configuring extroot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>block info &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span> | grep -o -e &lt;span style="color:#e6db74">&amp;#39;UUID=&amp;#34;\S*&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>block info | grep -o -e &lt;span style="color:#e6db74">&amp;#39;MOUNT=&amp;#34;\S*/overlay&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci -q delete fstab.extroot
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot.uuid&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>UUID&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot.target&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>MOUNT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci commit fstab
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Configuring rootfs_data / ubifs&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ORIG&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>block info | sed -n -e &lt;span style="color:#e6db74">&amp;#39;/MOUNT=&amp;#34;\S*\/overlay&amp;#34;/s/:\s.*$//p&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci -q delete fstab.rwm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm.device&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>ORIG&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm.target&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/rwm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci commit fstab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>按y，一路回车&lt;/p>
&lt;h2 id="复制内置闪存的文件" >
&lt;div>
&lt;a href="#%e5%a4%8d%e5%88%b6%e5%86%85%e7%bd%ae%e9%97%aa%e5%ad%98%e7%9a%84%e6%96%87%e4%bb%b6">
#
&lt;/a>
复制内置闪存的文件
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mount &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span> /mnt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -C &lt;span style="color:#e6db74">${&lt;/span>MOUNT&lt;span style="color:#e6db74">}&lt;/span> -cvf - . | tar -C /mnt -xf -
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>此时检查software的可用容量应该是U盘的容量了&lt;/p>
&lt;ul>
&lt;li>实测直接拔掉U盘重启就会自动使用内置的闪存启动,不需要任何配置&lt;/li>
&lt;li>安装系统更新不确定会发生什么,最好不要这么做&lt;/li>
&lt;/ul></description></item></channel></rss>