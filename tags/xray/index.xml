<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Xray on 0x2196f3's blog</title><link>/tags/xray/</link><description>0x2196f3's blog (Xray)</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Fri, 04 Jul 2025 00:00:00 +0000</lastBuildDate><atom:link href="/tags/xray/index.xml" rel="self" type="application/rss+xml"/><item><title>Xray Reality 偷域名经验</title><link>/posts/xray-reality-target/</link><pubDate>Fri, 04 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/xray-reality-target/</guid><description>&lt;h2 id="搜索同asn同地区可用域名" >
&lt;div>
&lt;a href="#%e6%90%9c%e7%b4%a2%e5%90%8casn%e5%90%8c%e5%9c%b0%e5%8c%ba%e5%8f%af%e7%94%a8%e5%9f%9f%e5%90%8d">
#
&lt;/a>
搜索同ASN同地区可用域名
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://search.censys.io">search.censys.io&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/censys.gif" alt="censys">&lt;/p>
&lt;p>搜索框输入以下内容,不登录只能看一页,Per Page选100,Virtual Hosts 选INCLUDE或ONLY&lt;/p>
&lt;blockquote>
&lt;p>把ASN换成服务器所在ASN（5位数字）， country换成服务器所在国家&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>autonomous_system.asn:00000 and location.country: &amp;#34;United States&amp;#34; and services: (port: 443 and service_name: HTTP and http.response.status_code: 200 and tls.version_selected: TLSv1_3)
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://workshop.censys.io/censys-search-questions/">censys search语法&lt;/a>&lt;/p>
&lt;h2 id="检查可用性" >
&lt;div>
&lt;a href="#%e6%a3%80%e6%9f%a5%e5%8f%af%e7%94%a8%e6%80%a7">
#
&lt;/a>
检查可用性
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>不翻墙可以正常访问&lt;/li>
&lt;li>网页有内容&lt;/li>
&lt;li>路径&lt;code>/&lt;/code>使用http/2 (F12 -&amp;gt; Network)&lt;/li>
&lt;li>路径&lt;code>/&lt;/code>返回200 (F12 -&amp;gt; Network)&lt;/li>
&lt;li>tls v1.3且支持x25519 (F12 -&amp;gt; Security)&lt;/li>
&lt;/ul>
&lt;h2 id="检查网站没有使用cdn" >
&lt;div>
&lt;a href="#%e6%a3%80%e6%9f%a5%e7%bd%91%e7%ab%99%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8cdn">
#
&lt;/a>
检查网站没有使用CDN
&lt;/div>
&lt;/h2>
&lt;ol>
&lt;li>在&lt;a href="https://dns.google">dns.google&lt;/a>查询域名解析出的ip&lt;/li>
&lt;li>拿查到的ip去&lt;a href="https://ip.sb">ip.sb&lt;/a>或&lt;a href="https://ip138.com">ip138.com&lt;/a>查询ASN归属,确认不属于CDN提供商&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>https://target.domain/cdn-cgi/trace&lt;/code> 访问这个路径,有内容说明使用了Cloudflare CDN,&lt;strong>有人扫,绝对不能用&lt;/strong>&lt;/li>
&lt;li>一般小网站但解析出多个ip地址很有可能使用了CDN,不能用&lt;/li>
&lt;/ul>
&lt;h2 id="网站安全检查" >
&lt;div>
&lt;a href="#%e7%bd%91%e7%ab%99%e5%ae%89%e5%85%a8%e6%a3%80%e6%9f%a5">
#
&lt;/a>
网站安全检查
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>在搜索引擎里搜索网站名称,能搜到这个域名说明至少搜索引擎认为这个网站比较正常.&lt;/li>
&lt;li>不要用中文网站尤其是有备案号的(有备案号ip肯定在中国),极有可能是黑产网站隐藏在看起来正常的静态网页里.&lt;/li>
&lt;li>外国大公司能产生大量流量的网站,要么在中国有CDN要么被墙了,所以最好都不要用.&lt;/li>
&lt;/ul>
&lt;h2 id="验证伪装域名正常工作" >
&lt;div>
&lt;a href="#%e9%aa%8c%e8%af%81%e4%bc%aa%e8%a3%85%e5%9f%9f%e5%90%8d%e6%ad%a3%e5%b8%b8%e5%b7%a5%e4%bd%9c">
#
&lt;/a>
验证伪装域名正常工作
&lt;/div>
&lt;/h2>
&lt;p>在没有翻墙的电脑改host(被偷的域名 -&amp;gt; VPS ip),用浏览器访问&lt;code>https://域名&lt;/code>,没有证书报错并且显示的内容和没改host时一模一样,说明reality正常工作.&lt;/p>
&lt;h2 id="注意事项" >
&lt;div>
&lt;a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
#
&lt;/a>
注意事项
&lt;/div>
&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>xtls-rprx-vision不支持mux(多路复用),一条内层连接一定对应一条外层连接.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reality服务器每收到一个请求,不管reality验证有没有通过,都要向域名的源服务器建立一个连接.&lt;br>
这就导致翻墙时整个设备经过代理的tcp连接数=VPS单个ip到域名的源服务器的tcp连接数(尽管很快就关闭了也没多少流量),可能被该网站ban ip.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>因此,向reality节点建立连接时第一个RTT的延迟=client 到 VPS的延迟 + VPS 到被偷网站的延迟,实测在局域网搭建偷&lt;code>yahoo.com&lt;/code>的reality,连接局域网内的服务也有几百毫秒的延迟&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reality验证失败时会进入爬虫模式,此时也会对目标域名的源服务器建立大量爬内容的请求,如果短时间大量连接reality的请求失败,也会对域名源服务器产生大量请求导致被ban&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>我测试时被好几个源站ban了ip,所以可能短时间内reality多次验证失败就足够稳定触发某种fail2ban的默认设定.&lt;/li>
&lt;/ul>
&lt;ol start="5">
&lt;li>感觉运营商/GFW会对非白名单的sni做tls连接的限速/劣化:&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>一个reality ipv4经常经历&lt;strong>准确的&lt;/strong>30秒ip完全被阻断然后立刻完全恢复正常(也没有限速),只换了目标域名没换ip暂时解决.&lt;/li>
&lt;li>另一个reality ipv6白天速度能跑满宽带,但晚上被限速&lt;strong>稳定的&lt;/strong>0.5mbps,此时同ip同端口udp的hysteria(sni=bing.com,bbr)没有被限速(100+mbps)&lt;/li>
&lt;/ul></description></item></channel></rss>