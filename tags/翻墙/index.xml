<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>翻墙 on 0x2196f3's blog</title><link>/tags/%E7%BF%BB%E5%A2%99/</link><description>0x2196f3's blog (翻墙)</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Fri, 12 Dec 2025 00:00:00 +0000</lastBuildDate><atom:link href="/tags/%E7%BF%BB%E5%A2%99/index.xml" rel="self" type="application/rss+xml"/><item><title>Hysteria2测试</title><link>/posts/hysteria2-test/</link><pubDate>Fri, 12 Dec 2025 00:00:00 +0000</pubDate><guid>/posts/hysteria2-test/</guid><description>&lt;h1 id="使用自签证书的安全提示" >
&lt;div>
&lt;a href="#%e4%bd%bf%e7%94%a8%e8%87%aa%e7%ad%be%e8%af%81%e4%b9%a6%e7%9a%84%e5%ae%89%e5%85%a8%e6%8f%90%e7%a4%ba">
##
&lt;/a>
使用自签证书的安全提示
&lt;/div>
&lt;/h1>
&lt;ol>
&lt;li>此时hysteria无法防御主动探测,因为无法提供伪装网站的合法ssl证书.&lt;br>
所以想精准识别hysteria非常容易,现在不封只是GFW对quic的封锁还不成熟.&lt;/li>
&lt;li>客户端建议pin自签的证书,否则可能被中间人攻击&lt;/li>
&lt;/ol>
&lt;h1 id="性能" >
&lt;div>
&lt;a href="#%e6%80%a7%e8%83%bd">
##
&lt;/a>
性能
&lt;/div>
&lt;/h1>
&lt;p>使用bbr时跑100mbps对性能没有什么要求&lt;/p>
&lt;h1 id="速度测试" >
&lt;div>
&lt;a href="#%e9%80%9f%e5%ba%a6%e6%b5%8b%e8%af%95">
##
&lt;/a>
速度测试
&lt;/div>
&lt;/h1>
&lt;p>正常情况下quic直连墙外会被阻断到无法使用.&lt;/p>
&lt;p>比如&lt;a href="https://dash.cloudflare.com">dash.cloudflare.com&lt;/a>,F12-&amp;gt;Network可以看到大量使用h3下载的js,速度极慢导致网页&lt;strong>全天&lt;/strong>完全不可用,只有浏览器/路由器禁用h3才能正常登录.&lt;/p>
&lt;p>但是某垃圾VPS晚高峰测速,hysteria仅用bbr就能100+mbps,同ip同端口的reality被限速0.5mbps.加上&lt;code>dash.cloudflare.com&lt;/code>h2正常h3不可用,说明过墙的h3不是拥堵而是是被运营商/GFW主动劣化到不能用的.&lt;/p>
&lt;p>我测试用的hysteria可能因为sni是&lt;code>bing.com&lt;/code>在白名单里所以不被限速/丢包&lt;/p>
&lt;h1 id="tips" >
&lt;div>
&lt;a href="#tips">
##
&lt;/a>
Tips
&lt;/div>
&lt;/h1>
&lt;ul>
&lt;li>如果用别人的域名,因为不防主动探测,建议使用ipv6部署hysteria,封了换ip比较容易.&lt;/li>
&lt;li>GFW审查quic的成本高于其它基于tcp的翻墙协议,因为quic里传输的所有内容都是加密的,从加密的quic中解密出sni的计算量比直接从tcp中读取明文sni大.&lt;/li>
&lt;li>使用docker &lt;code>-p [::]:443:443/udp&lt;/code>即可&lt;strong>仅&lt;/strong>让此容器监听ipv6发来的udp数据包,同时另一个容器监听同端口的tcp连接&lt;code>-p 443:443/tcp&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h1 id="部署" >
&lt;div>
&lt;a href="#%e9%83%a8%e7%bd%b2">
##
&lt;/a>
部署
&lt;/div>
&lt;/h1>
&lt;h2 id="服务端" >
&lt;div>
&lt;a href="#%e6%9c%8d%e5%8a%a1%e7%ab%af">
#
&lt;/a>
服务端
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>安装docker&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>创建一个hysteria目录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mkdir hysteria &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> cd hysteria
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>生成自签证书&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>openssl req -x509 -nodes -newkey ec:&amp;lt;&lt;span style="color:#f92672">(&lt;/span>openssl ecparam -name prime256v1&lt;span style="color:#f92672">)&lt;/span> -keyout ./server.key -out ./server.crt -subj &lt;span style="color:#e6db74">&amp;#34;/CN=bing.com&amp;#34;&lt;/span> -days &lt;span style="color:#ae81ff">36500&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>生成配置文件&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nano hysteria.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">tls&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">cert&lt;/span>: &lt;span style="color:#ae81ff">/etc/hysteria/server.crt&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">key&lt;/span>: &lt;span style="color:#ae81ff">/etc/hysteria/server.key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">auth&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">password&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">password&lt;/span>: &lt;span style="color:#ae81ff">123456&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">masquerade&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">type&lt;/span>: &lt;span style="color:#ae81ff">proxy&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">proxy&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">url&lt;/span>: &lt;span style="color:#ae81ff">https://bing.com&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">rewriteHost&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>运行&amp;amp;开机自启动&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run -d --name hysteria --pull always --restart always -p 443:443/udp -v ./hysteria/:/etc/hysteria/ tobyxdd/hysteria server -c /etc/hysteria/hysteria.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>检查hysteria是否正常运行&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker logs hysteria
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="客户端" >
&lt;div>
&lt;a href="#%e5%ae%a2%e6%88%b7%e7%ab%af">
#
&lt;/a>
客户端
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>长期使用建议直接用sing-box或mihomo&lt;/li>
&lt;/ul>
&lt;p>Windows:下载&lt;a href="https://github.com/apernet/hysteria/releases">hysteria-windows-amd64-avx.exe&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>config.yaml,保存到exe同目录&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">server&lt;/span>: [&lt;span style="color:#ae81ff">your-ip]:[your-port]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">auth&lt;/span>: [&lt;span style="color:#ae81ff">your-password]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">tls&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">insecure&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">http&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">listen&lt;/span>: &lt;span style="color:#ae81ff">127.0.0.1&lt;/span>:&lt;span style="color:#ae81ff">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">disableUDP&lt;/span>: &lt;span style="color:#66d9ef">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我的Windows无法开启Socks5代理,只用http&lt;/p>
&lt;ul>
&lt;li>手动将系统代理设置为&lt;code>127.0.0.1:8080&lt;/code>&lt;/li>
&lt;li>或Firefox里单独给浏览器设置代理&lt;/li>
&lt;/ul></description></item><item><title>OpenWrt设置usb扩容</title><link>/posts/openwrt-set-usb-overlay/</link><pubDate>Mon, 27 Oct 2025 00:00:00 +0000</pubDate><guid>/posts/openwrt-set-usb-overlay/</guid><description>&lt;h1 id="openwrt设置usb扩容" >
&lt;div>
&lt;a href="#openwrt%e8%ae%be%e7%bd%aeusb%e6%89%a9%e5%ae%b9">
##
&lt;/a>
OpenWrt设置usb扩容
&lt;/div>
&lt;/h1>
&lt;p>&lt;a href="https://openwrt.org/docs/guide-user/additional-software/extroot_configuration">原文&lt;/a>&lt;/p>
&lt;h2 id="连接ssh" >
&lt;div>
&lt;a href="#%e8%bf%9e%e6%8e%a5ssh">
#
&lt;/a>
连接SSH
&lt;/div>
&lt;/h2>
&lt;h2 id="安装软件包" >
&lt;div>
&lt;a href="#%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6%e5%8c%85">
#
&lt;/a>
安装软件包
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>opkg update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>opkg install block-mount kmod-fs-ext4 e2fsprogs parted kmod-usb-storage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看usb设备位置" >
&lt;div>
&lt;a href="#%e6%9f%a5%e7%9c%8busb%e8%ae%be%e5%a4%87%e4%bd%8d%e7%bd%ae">
#
&lt;/a>
查看USB设备位置
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ls -l /sys/block
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果是无线路由器只有一个外接存储，大概率是&lt;code>sda&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>lrwxrwxrwx &lt;span style="color:#ae81ff">1&lt;/span> root root &lt;span style="color:#ae81ff">0&lt;/span> xxx xx xx:xx sda -&amp;gt; ../devices/xxx/block/sda
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="在usb上创建分区格式化设置exroot并自动挂载" >
&lt;div>
&lt;a href="#%e5%9c%a8usb%e4%b8%8a%e5%88%9b%e5%bb%ba%e5%88%86%e5%8c%ba%e6%a0%bc%e5%bc%8f%e5%8c%96%e8%ae%be%e7%bd%aeexroot%e5%b9%b6%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd">
#
&lt;/a>
在USB上创建分区，格式化，设置exroot并自动挂载
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Partitioning and formatting&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DISK&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/dev/sda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>parted -s &lt;span style="color:#e6db74">${&lt;/span>DISK&lt;span style="color:#e6db74">}&lt;/span> -- mklabel gpt mkpart extroot 2048s -2048s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DEVICE&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>DISK&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mkfs.ext4 -L extroot &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Configuring extroot&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>block info &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span> | grep -o -e &lt;span style="color:#e6db74">&amp;#39;UUID=&amp;#34;\S*&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>block info | grep -o -e &lt;span style="color:#e6db74">&amp;#39;MOUNT=&amp;#34;\S*/overlay&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci -q delete fstab.extroot
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot.uuid&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>UUID&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.extroot.target&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>MOUNT&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci commit fstab
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#Configuring rootfs_data / ubifs&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ORIG&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>block info | sed -n -e &lt;span style="color:#e6db74">&amp;#39;/MOUNT=&amp;#34;\S*\/overlay&amp;#34;/s/:\s.*$//p&amp;#39;&lt;/span>&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci -q delete fstab.rwm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;mount&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm.device&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>ORIG&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci set fstab.rwm.target&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/rwm&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uci commit fstab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>按y，一路回车&lt;/p>
&lt;h2 id="复制内置闪存的文件" >
&lt;div>
&lt;a href="#%e5%a4%8d%e5%88%b6%e5%86%85%e7%bd%ae%e9%97%aa%e5%ad%98%e7%9a%84%e6%96%87%e4%bb%b6">
#
&lt;/a>
复制内置闪存的文件
&lt;/div>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mount &lt;span style="color:#e6db74">${&lt;/span>DEVICE&lt;span style="color:#e6db74">}&lt;/span> /mnt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -C &lt;span style="color:#e6db74">${&lt;/span>MOUNT&lt;span style="color:#e6db74">}&lt;/span> -cvf - . | tar -C /mnt -xf -
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>此时检查software的可用容量应该是U盘的容量了&lt;/p>
&lt;ul>
&lt;li>实测直接拔掉U盘重启就会自动使用内置的闪存启动,不需要任何配置&lt;/li>
&lt;li>安装系统更新不确定会发生什么,最好不要这么做&lt;/li>
&lt;/ul></description></item><item><title>HTTP3(quic) 直连黑名单域名测试</title><link>/posts/quic-bypass-gfw-test/</link><pubDate>Sun, 17 Aug 2025 00:00:00 +0000</pubDate><guid>/posts/quic-bypass-gfw-test/</guid><description>&lt;h1 id="http3quic-直连黑名单域名测试" >
&lt;div>
&lt;a href="#http3quic-%e7%9b%b4%e8%bf%9e%e9%bb%91%e5%90%8d%e5%8d%95%e5%9f%9f%e5%90%8d%e6%b5%8b%e8%af%95">
##
&lt;/a>
HTTP3(quic) 直连黑名单域名测试
&lt;/div>
&lt;/h1>
&lt;p>根据&lt;a href="https://gfw.report/publications/usenixsecurity25/zh/">揭示并绕过中国防火长城基于SNI的QUIC封锁机制&lt;/a>,我的看法:&lt;br>
目前(2025年8月)&lt;/p>
&lt;ul>
&lt;li>对quic的封锁漏洞百出,可以轻松绕过&lt;/li>
&lt;li>虽然少量流量瘫痪gfw是gfw的bug可以被修复,但审查quic连接的计算量还是比http1/2大不少,这是quic特性无法解决&lt;/li>
&lt;li>gfw审查不过来quic的时候会直接放行&lt;/li>
&lt;li>虽然src_port &amp;lt; dst_port时gfw会直接放行但使用&amp;lt; 443的端口需要提权,不合适&lt;/li>
&lt;/ul>
&lt;h2 id="http3中国直连黑名单域名测试方法" >
&lt;div>
&lt;a href="#http3%e4%b8%ad%e5%9b%bd%e7%9b%b4%e8%bf%9e%e9%bb%91%e5%90%8d%e5%8d%95%e5%9f%9f%e5%90%8d%e6%b5%8b%e8%af%95%e6%96%b9%e6%b3%95">
#
&lt;/a>
http3中国直连黑名单域名测试方法
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>curl测试 (ubuntu curl 8.5.0)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl --connect-to example.com:443:&lt;span style="color:#f92672">[&lt;/span>x:x:x:x::x&lt;span style="color:#f92672">]&lt;/span>:443 https://example.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>quic测试 (quic-go 0.54.0)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./quic-dl --connect-to &lt;span style="color:#f92672">[&lt;/span>x:x:x:x::x&lt;span style="color:#f92672">]&lt;/span>:443 https://example.com index.html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>所有网站使用&lt;code>dns.google&lt;/code>取得无污染解析,用无污染的ipv6直连&lt;/li>
&lt;li>套Fastly CDN的网站都使用&lt;code>www.fastly.com&lt;/code>解析的ipv6地址连接(除&lt;code>twitch.tv&lt;/code>报错),所以&lt;code>pinterest.com&lt;/code>dns查不到ipv6也是用ipv6连的&lt;/li>
&lt;li>quic建立连接前先用本机同端口发送两个80-120 bytes的随机数据包干扰审查&lt;/li>
&lt;li>不确定这些quic成功连接的网站是 &lt;br>
1.不在quic sni的黑名单里 &lt;br>
2.通过先发送两个随机数据包绕过了gfw的sni审查 &lt;br>
3.gfw负载太大直接放行&lt;/li>
&lt;/ul>
&lt;h2 id="测试结果" >
&lt;div>
&lt;a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c">
#
&lt;/a>
测试结果
&lt;/div>
&lt;/h2>
&lt;h3 id="普通黑名单网站" >
&lt;div>
&lt;a href="#%e6%99%ae%e9%80%9a%e9%bb%91%e5%90%8d%e5%8d%95%e7%bd%91%e7%ab%99">
##
&lt;/a>
普通黑名单网站
&lt;/div>
&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>域名&lt;/th>
&lt;th>备注&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>raw.githubusercontent.com&lt;/td>
&lt;td>不支持quic&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>duckduckgo.com&lt;/td>
&lt;td>不支持quic&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>whatsapp.com&lt;/td>
&lt;td>ip被墙&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>google.com.au&lt;/td>
&lt;td>ip被墙,&lt;code>dl.google.com&lt;/code>的ip似乎不响应这个请求&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 id="cloudflare-cdn" >
&lt;div>
&lt;a href="#cloudflare-cdn">
##
&lt;/a>
Cloudflare CDN
&lt;/div>
&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>域名&lt;/th>
&lt;th>Curl（HTTP 1.1/2）&lt;/th>
&lt;th>QUIC&lt;/th>
&lt;th>DNS污染&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>cloudflare.com&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>未被墙&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>*.pages.dev (它和cdn的ip不共用)&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>无&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>medium.com&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>archiveofourown.org&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hentai.name&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 id="fastly-cdn" >
&lt;div>
&lt;a href="#fastly-cdn">
##
&lt;/a>
Fastly CDN
&lt;/div>
&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>域名&lt;/th>
&lt;th>Curl（HTTP 1.1/2）&lt;/th>
&lt;th>QUIC&lt;/th>
&lt;th>DNS污染&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>fastly.com&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>未被墙&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pinterest.com&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reddit.com&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>twitch.tv&lt;/td>
&lt;td>RESET&lt;/td>
&lt;td>成功&lt;/td>
&lt;td>有&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="quic-dl" >
&lt;div>
&lt;a href="#quic-dl">
#
&lt;/a>
quic-dl
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>go.mod&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go.mod" data-lang="go.mod">&lt;span style="display:flex;">&lt;span>module quic&lt;span style="color:#f92672">-&lt;/span>dl
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go &lt;span style="color:#ae81ff">1.25&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>require (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> github.com&lt;span style="color:#f92672">/&lt;/span>quic&lt;span style="color:#f92672">-&lt;/span>go&lt;span style="color:#f92672">/&lt;/span>quic&lt;span style="color:#f92672">-&lt;/span>go v0.&lt;span style="color:#ae81ff">54.0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>main.go&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-golang" data-lang="golang">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;crypto/tls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;flag&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">quic&lt;/span> &lt;span style="color:#e6db74">&amp;#34;github.com/quic-go/quic-go&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;github.com/quic-go/quic-go/http3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">sendRandomUDP&lt;/span>(&lt;span style="color:#a6e22e">conn&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">UDPConn&lt;/span>, &lt;span style="color:#a6e22e">dst&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">UDPAddr&lt;/span>) (&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#66d9ef">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Determine random length in [80, 120]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">length&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">rand&lt;/span>.&lt;span style="color:#a6e22e">Intn&lt;/span>(&lt;span style="color:#ae81ff">41&lt;/span>) &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Fill buffer with cryptographically random bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">buf&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, &lt;span style="color:#a6e22e">length&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">rand&lt;/span>.&lt;span style="color:#a6e22e">Read&lt;/span>(&lt;span style="color:#a6e22e">buf&lt;/span>); &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Errorf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;failed to generate random data: %w&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Send via the shared UDPConn&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">conn&lt;/span>.&lt;span style="color:#a6e22e">WriteToUDP&lt;/span>(&lt;span style="color:#a6e22e">buf&lt;/span>, &lt;span style="color:#a6e22e">dst&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Errorf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;failed to send data: %w&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Run&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Optional flags&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">method&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;X&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;GET&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;HTTP method to use&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">headers&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;H&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;HTTP headers, separated by \\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;d&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Request body data&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">connectTo&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">String&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;connect-to&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Override QUIC dial target, e.g. 1.1.1.1:443 or [::1]:443&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Parse&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">NArg&lt;/span>() &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Usage&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">os&lt;/span>.&lt;span style="color:#a6e22e">Exit&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">url&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Arg&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">outPath&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">flag&lt;/span>.&lt;span style="color:#a6e22e">Arg&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Build HTTP request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">body&lt;/span> &lt;span style="color:#a6e22e">io&lt;/span>.&lt;span style="color:#a6e22e">Reader&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">body&lt;/span> = &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">NewReader&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">data&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">req&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">NewRequest&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">method&lt;/span>, &lt;span style="color:#a6e22e">url&lt;/span>, &lt;span style="color:#a6e22e">body&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;creating request: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">headers&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">h&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">Split&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">headers&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;\n&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">parts&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">SplitN&lt;/span>(&lt;span style="color:#a6e22e">h&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;:&amp;#34;&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(&lt;span style="color:#a6e22e">parts&lt;/span>) &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;invalid header: %s&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">h&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">req&lt;/span>.&lt;span style="color:#a6e22e">Header&lt;/span>.&lt;span style="color:#a6e22e">Add&lt;/span>(&lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">TrimSpace&lt;/span>(&lt;span style="color:#a6e22e">parts&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>]), &lt;span style="color:#a6e22e">strings&lt;/span>.&lt;span style="color:#a6e22e">TrimSpace&lt;/span>(&lt;span style="color:#a6e22e">parts&lt;/span>[&lt;span style="color:#ae81ff">1&lt;/span>]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Prepare HTTP/3 transport&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">quicConfig&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">h3&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">http3&lt;/span>.&lt;span style="color:#a6e22e">Transport&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">TLSClientConfig&lt;/span>: &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">tls&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">InsecureSkipVerify&lt;/span>: &lt;span style="color:#66d9ef">true&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">NextProtos&lt;/span>: []&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;h3&amp;#34;&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">QUICConfig&lt;/span>: &lt;span style="color:#a6e22e">quicConfig&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// If --connect-to is set, override Dial&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">remoteAddr&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">ResolveUDPAddr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;udp&amp;#34;&lt;/span>, &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;resolving %s: %v&amp;#34;&lt;/span>, &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">net&lt;/span>.&lt;span style="color:#a6e22e">ListenUDP&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;udp&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">localAddr&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">pktConn&lt;/span>.&lt;span style="color:#a6e22e">LocalAddr&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Using local address: %v\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">localAddr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;opening UDP socket: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">h3&lt;/span>.&lt;span style="color:#a6e22e">Dial&lt;/span> = &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span> &lt;span style="color:#a6e22e">context&lt;/span>.&lt;span style="color:#a6e22e">Context&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>, &lt;span style="color:#a6e22e">tlsCfg&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">tls&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>, &lt;span style="color:#a6e22e">cfg&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">Config&lt;/span>) (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">Conn&lt;/span>, &lt;span style="color:#66d9ef">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">quic&lt;/span>.&lt;span style="color:#a6e22e">DialEarly&lt;/span>(&lt;span style="color:#a6e22e">ctx&lt;/span>, &lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">remoteAddr&lt;/span>, &lt;span style="color:#a6e22e">tlsCfg&lt;/span>, &lt;span style="color:#a6e22e">cfg&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">sendRandomUDP&lt;/span>(&lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">remoteAddr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">sendRandomUDP&lt;/span>(&lt;span style="color:#a6e22e">pktConn&lt;/span>, &lt;span style="color:#a6e22e">remoteAddr&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">client&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">http&lt;/span>.&lt;span style="color:#a6e22e">Client&lt;/span>{&lt;span style="color:#a6e22e">Transport&lt;/span>: &lt;span style="color:#a6e22e">h3&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">h3&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Execute request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">resp&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">client&lt;/span>.&lt;span style="color:#a6e22e">Do&lt;/span>(&lt;span style="color:#a6e22e">req&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;HTTP/3 request failed: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">Body&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">ProtoMajor&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;server does not support HTTP/3: %s&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">Proto&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Save response to file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">outFile&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">os&lt;/span>.&lt;span style="color:#a6e22e">Create&lt;/span>(&lt;span style="color:#a6e22e">outPath&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;create file: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">defer&lt;/span> &lt;span style="color:#a6e22e">outFile&lt;/span>.&lt;span style="color:#a6e22e">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">io&lt;/span>.&lt;span style="color:#a6e22e">Copy&lt;/span>(&lt;span style="color:#a6e22e">outFile&lt;/span>, &lt;span style="color:#a6e22e">resp&lt;/span>.&lt;span style="color:#a6e22e">Body&lt;/span>); &lt;span style="color:#a6e22e">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#66d9ef">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">log&lt;/span>.&lt;span style="color:#a6e22e">Fatalf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;writing file: %v&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">err&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Downloaded %s to %s via HTTP/3 (connect-to=%s)\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">url&lt;/span>, &lt;span style="color:#a6e22e">outPath&lt;/span>, &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">connectTo&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Printf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Downloaded %s to %s via HTTP/3 (default dial)\n&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">url&lt;/span>, &lt;span style="color:#a6e22e">outPath&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>build &amp;amp; run&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>go mod tidy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go run main.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Gcore CDN域前置翻墙</title><link>/posts/gcore-cdn-proxy/</link><pubDate>Sun, 10 Aug 2025 00:00:00 +0000</pubDate><guid>/posts/gcore-cdn-proxy/</guid><description>&lt;h2 id="域前置" >
&lt;div>
&lt;a href="#%e5%9f%9f%e5%89%8d%e7%bd%ae">
#
&lt;/a>
域前置
&lt;/div>
&lt;/h2>
&lt;p>客户端向CDN发起https请求，连接CDN时使用假sni，cdn解开https的加密后发现host和sni不一样，就将请求转发给host域名的源服务器（而不是报错或转发给sni的源服务器），大部分CDN服务商不支持这种操作。&lt;/p>
&lt;h2 id="配置" >
&lt;div>
&lt;a href="#%e9%85%8d%e7%bd%ae">
#
&lt;/a>
配置
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://bulianglin.com/archives/ws.html">不良林的教程&lt;/a>
&lt;a href="https://www.youtube.com/watch?v=FT-O4Xd9gTw">不良林的视频&lt;/a>&lt;/p>
&lt;ul>
&lt;li>除了tls in tls特征能检测出你在翻墙之外，ip和域名都不是自己的，防火墙封ip封域名不会对翻墙用户造成损失&lt;/li>
&lt;li>Gcore暂时不会验证host域名的所有者，所以不需要自己有域名&lt;/li>
&lt;li>没有域名的话源服务器仅支持ipv4地址，可以自定义端口&lt;/li>
&lt;li>每月免费1TB流量，&lt;strong>需要绑定支付方式&lt;/strong>&lt;/li>
&lt;li>同样的CDN配置除了vmess+ws也可以过vless+xhttp（vless没有加密，cdn可以看到明文的dns请求和sni）&lt;/li>
&lt;li>如果已有一个vmess/vless+ws/xhttp过CDN的xray配置，不需要任何修改就能用&lt;/li>
&lt;li>Gcore的ip被封锁很严重，即使优选ip也不稳定&lt;/li>
&lt;/ul></description></item><item><title>Mihomo (Clash Meta) API示例</title><link>/posts/mihomo-api-usage/</link><pubDate>Sun, 06 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/mihomo-api-usage/</guid><description>&lt;p>&lt;a href="https://wiki.metacubex.one/api/">Mihomo官方文档&lt;/a>写的很简略,找示例可以在&lt;a href="https://github.com/MetaCubeX/metacubexd">MedaCubeXD&lt;/a>的源码里找&lt;/p>
&lt;p>也可以在浏览器的F12里监视MetaCubeXD页面的Network,抄到curl里就能用&lt;/p>
&lt;h2 id="比如" >
&lt;div>
&lt;a href="#%e6%af%94%e5%a6%82">
#
&lt;/a>
比如
&lt;/div>
&lt;/h2>
&lt;blockquote>
&lt;p>切换节点&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> http://192.168.1.1:9090/proxies/节点所在的组/?force&lt;span style="color:#f92672">=&lt;/span>true -d &lt;span style="color:#e6db74">&amp;#39;{&amp;#34;name&amp;#34;:&amp;#34;要切换到的节点名称&amp;#34;}&amp;#39;&lt;/span> -X PUT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>打断所有连接&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> http://192.168.1.1:9090/connections -X DELETE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>测试某个节点延迟&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;http://192.168.1.1:9090/proxies/节点名称/delay?url=https://gstatic.com/generate_204&amp;amp;timeout=5000&amp;#39;&lt;/span> -X GET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>获取所有节点信息&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;http://192.168.1.1:9090/proxies&amp;#39;&lt;/span> -X GET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这些curl命令可以在openwrt的crontab里直接使用&lt;/p>
&lt;blockquote>
&lt;p>凌晨三点切换节点&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> * * * curl -H &lt;span style="color:#e6db74">&amp;#39;Authorization: Bearer API密码&amp;#39;&lt;/span> http://127.0.0.1:9090/proxies/Youtube/?force&lt;span style="color:#f92672">=&lt;/span>true -d &lt;span style="color:#e6db74">&amp;#39;{&amp;#34;name&amp;#34;:&amp;#34;HK-xxx&amp;#34;}&amp;#39;&lt;/span> -X PUT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Xray Reality 偷域名经验</title><link>/posts/xray-reality-target/</link><pubDate>Fri, 04 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/xray-reality-target/</guid><description>&lt;h2 id="搜索同asn同地区可用域名" >
&lt;div>
&lt;a href="#%e6%90%9c%e7%b4%a2%e5%90%8casn%e5%90%8c%e5%9c%b0%e5%8c%ba%e5%8f%af%e7%94%a8%e5%9f%9f%e5%90%8d">
#
&lt;/a>
搜索同ASN同地区可用域名
&lt;/div>
&lt;/h2>
&lt;p>&lt;a href="https://search.censys.io">search.censys.io&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/censys.gif" alt="censys">&lt;/p>
&lt;p>搜索框输入以下内容,不登录只能看一页,Per Page选100,Virtual Hosts 选INCLUDE或ONLY&lt;/p>
&lt;blockquote>
&lt;p>把ASN换成服务器所在ASN（5位数字）， country换成服务器所在国家&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code>autonomous_system.asn:00000 and location.country: &amp;#34;United States&amp;#34; and services: (port: 443 and service_name: HTTP and http.response.status_code: 200 and tls.version_selected: TLSv1_3)
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://workshop.censys.io/censys-search-questions/">censys search语法&lt;/a>&lt;/p>
&lt;h2 id="检查可用性" >
&lt;div>
&lt;a href="#%e6%a3%80%e6%9f%a5%e5%8f%af%e7%94%a8%e6%80%a7">
#
&lt;/a>
检查可用性
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>不翻墙可以正常访问&lt;/li>
&lt;li>网页有内容&lt;/li>
&lt;li>路径&lt;code>/&lt;/code>使用http/2 (F12 -&amp;gt; Network)&lt;/li>
&lt;li>路径&lt;code>/&lt;/code>返回200 (F12 -&amp;gt; Network)&lt;/li>
&lt;li>tls v1.3且支持x25519 (F12 -&amp;gt; Security)&lt;/li>
&lt;/ul>
&lt;h2 id="检查网站没有使用cdn" >
&lt;div>
&lt;a href="#%e6%a3%80%e6%9f%a5%e7%bd%91%e7%ab%99%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8cdn">
#
&lt;/a>
检查网站没有使用CDN
&lt;/div>
&lt;/h2>
&lt;ol>
&lt;li>在&lt;a href="https://dns.google">dns.google&lt;/a>查询域名解析出的ip&lt;/li>
&lt;li>拿查到的ip去&lt;a href="https://ip.sb">ip.sb&lt;/a>或&lt;a href="https://ip138.com">ip138.com&lt;/a>查询ASN归属,确认不属于CDN提供商&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>https://target.domain/cdn-cgi/trace&lt;/code> 访问这个路径,有内容说明使用了Cloudflare CDN,&lt;strong>有人扫,绝对不能用&lt;/strong>&lt;/li>
&lt;li>一般小网站但解析出多个ip地址很有可能使用了CDN,不能用&lt;/li>
&lt;/ul>
&lt;h2 id="网站安全检查" >
&lt;div>
&lt;a href="#%e7%bd%91%e7%ab%99%e5%ae%89%e5%85%a8%e6%a3%80%e6%9f%a5">
#
&lt;/a>
网站安全检查
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>在搜索引擎里搜索网站名称,能搜到这个域名说明至少搜索引擎认为这个网站比较正常.&lt;/li>
&lt;li>不要用中文网站尤其是有备案号的(有备案号ip肯定在中国),极有可能是黑产网站隐藏在看起来正常的静态网页里.&lt;/li>
&lt;li>外国大公司能产生大量流量的网站,要么在中国有CDN要么被墙了,所以最好都不要用.&lt;/li>
&lt;/ul>
&lt;h2 id="验证伪装域名正常工作" >
&lt;div>
&lt;a href="#%e9%aa%8c%e8%af%81%e4%bc%aa%e8%a3%85%e5%9f%9f%e5%90%8d%e6%ad%a3%e5%b8%b8%e5%b7%a5%e4%bd%9c">
#
&lt;/a>
验证伪装域名正常工作
&lt;/div>
&lt;/h2>
&lt;p>在没有翻墙的电脑改host(被偷的域名 -&amp;gt; VPS ip),用浏览器访问&lt;code>https://域名&lt;/code>,没有证书报错并且显示的内容和没改host时一模一样,说明reality正常工作.&lt;/p>
&lt;h2 id="注意事项" >
&lt;div>
&lt;a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
#
&lt;/a>
注意事项
&lt;/div>
&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>xtls-rprx-vision不支持mux(多路复用),一条内层连接一定对应一条外层连接.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reality服务器每收到一个请求,不管reality验证有没有通过,都要向域名的源服务器建立一个连接.&lt;br>
这就导致翻墙时整个设备经过代理的tcp连接数=VPS单个ip到域名的源服务器的tcp连接数(尽管很快就关闭了也没多少流量),可能被该网站ban ip.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>因此,向reality节点建立连接时第一个RTT的延迟=client 到 VPS的延迟 + VPS 到被偷网站的延迟,实测在局域网搭建偷&lt;code>yahoo.com&lt;/code>的reality,连接局域网内的服务也有几百毫秒的延迟&lt;/p>
&lt;/li>
&lt;li>
&lt;p>reality验证失败时会进入爬虫模式,此时也会对目标域名的源服务器建立大量爬内容的请求,如果短时间大量连接reality的请求失败,也会对域名源服务器产生大量请求导致被ban&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>我测试时被好几个源站ban了ip,所以可能短时间内reality多次验证失败就足够稳定触发某种fail2ban的默认设定.&lt;/li>
&lt;/ul>
&lt;ol start="5">
&lt;li>感觉运营商/GFW会对非白名单的sni做tls连接的限速/劣化:&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>一个reality ipv4经常经历&lt;strong>准确的&lt;/strong>30秒ip完全被阻断然后立刻完全恢复正常(也没有限速),只换了目标域名没换ip暂时解决.&lt;/li>
&lt;li>另一个reality ipv6白天速度能跑满宽带,但晚上被限速&lt;strong>稳定的&lt;/strong>0.5mbps,此时同ip同端口udp的hysteria(sni=bing.com,bbr)没有被限速(100+mbps)&lt;/li>
&lt;/ul></description></item><item><title>搬瓦工VPS配置自定义IPv6地址</title><link>/posts/bandwagonhost-ipv6-configuration/</link><pubDate>Thu, 03 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/bandwagonhost-ipv6-configuration/</guid><description>&lt;p>搬瓦工提供的ipv6是通过6in4隧道连接到另一台服务器的ipv6出口的,公网ipv6地址在&lt;code>ipv6net&lt;/code>上,不是&lt;code>eth0&lt;/code>&lt;/p>
&lt;ul>
&lt;li>ipv6直连中国速度比ipv4慢不少&lt;/li>
&lt;li>删了ipv6重新分配还是原来的那个&lt;/li>
&lt;li>可以先用ipv6测试协议会不会被墙，没事再换成ipv4&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>搬瓦工后台通过&lt;code>ipv6net&lt;/code>这个service自动配置6in4隧道,配置脚本在&lt;code>/etc/init_ipv6_tunnel&lt;/code>,但修改这个脚本重启会复原&lt;br>
需要禁用&lt;code>ipv6net&lt;/code>这个服务,再手动配置&lt;code>/etc/network/interfaces&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>禁用ipv6net服务&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl stop ipv6net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>systemctl disable ipv6net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>手动配置ipv6地址(Ubuntu/Debian)&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nano /etc/network/interfaces
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>添加如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 所有ipv6地址都不带中括号&amp;#39;[&amp;#39;和&amp;#39;]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>auto ipv6net
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>iface ipv6net inet6 v4tunnel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> address &lt;span style="color:#f92672">[&lt;/span>your custom ipv6&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> netmask &lt;span style="color:#ae81ff">64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> endpoint *.*.*.*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local *.*.*.*
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ttl &lt;span style="color:#ae81ff">255&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gateway &lt;span style="color:#f92672">[&lt;/span>ipv6 gateway&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> up /sbin/ip -6 addr add &lt;span style="color:#f92672">[&lt;/span>another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> up /sbin/ip -6 addr add &lt;span style="color:#f92672">[&lt;/span>yet another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> down /sbin/ip -6 addr del &lt;span style="color:#f92672">[&lt;/span>another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> down /sbin/ip -6 addr del &lt;span style="color:#f92672">[&lt;/span>yet another custom ipv6&lt;span style="color:#f92672">]&lt;/span>/64 dev $IFACE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ip地址根据搬瓦工后台的配置照抄,up和down的ipv6地址一一对应,复制多行可以添加多个自定义ipv6地址&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>/64&lt;/code>代表自定义ipv6的后一半地址可以随便写,举例:&lt;/p>&lt;/blockquote>
&lt;pre tabindex="0">&lt;code># 这是网关
1111:2222:3333:4444::1/64
# 这是可用的ipv6地址
1111:2222:3333:4444:abcd:1234:abcd:1234
&lt;/code>&lt;/pre>&lt;blockquote>
&lt;p>重启网络&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl restart networking
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Xray Websocket/XHTTP过Cloudfront CDN</title><link>/posts/xray-over-cloudfront-cdn/</link><pubDate>Wed, 02 Jul 2025 00:00:00 +0000</pubDate><guid>/posts/xray-over-cloudfront-cdn/</guid><description>&lt;p>&lt;a href="https://bulianglin.com/archives/cft.html">不良林的教程&lt;/a>
&lt;a href="https://www.youtube.com/watch?v=MHFYRRo1Q8E">不良林的视频&lt;/a>&lt;/p>
&lt;h2 id="vxesswstls的cache-policy" >
&lt;div>
&lt;a href="#vxesswstls%e7%9a%84cache-policy">
#
&lt;/a>
VXESS+WS+TLS的Cache Policy
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/Cloudfront-VXESS+WS+TLS.PNG" alt="VXESS+WS+TLS">&lt;/p>
&lt;h2 id="xhttp的cache-policy" >
&lt;div>
&lt;a href="#xhttp%e7%9a%84cache-policy">
#
&lt;/a>
XHTTP的Cache Policy
&lt;/div>
&lt;/h2>
&lt;p>&lt;img src="https://0x2196f3.github.io/images/Cloudfront-XHTTP.PNG" alt="XHTTP">&lt;/p>
&lt;h2 id="注意事项" >
&lt;div>
&lt;a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9">
#
&lt;/a>
注意事项
&lt;/div>
&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>现在(2025-08及以后)新注册的AWS账号没有永久免费的1TB/月下载流量,没有账号就不必折腾了&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Cloudfront 可以根据不同的path设置不同的behavior，所以WS和XHTTP节点可以放在同一个CDN链接里共存&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Cloudfront 有非常强大的分流功能,一个CDN资源可以添加多个源,可以是同域名不同端口/不同域名/甚至直连IP,&lt;del>还支持执行简单的脚本(Cloudfront Function的免费额度较少,Lambda@Edge按量计费,最好都别碰防被反薅)&lt;/del>.&lt;br>
相比之下Cloudflare CDN免费版只支持重写端口.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不一定要有自己的域名才能使用Cloudfront,Cloudfront只说要有一个域名DNS解析成ipv4地址(update 2025-12 ipv6 only也支持了),没说域名要是自己的或要有ssl证书,所以可以使用&lt;code>1.2.3.4.nip.io&lt;/code>或&lt;code>fe80--1.sslip.io&lt;/code>这类通配符DNS域名,自动把带ip地址的域名解析成对应的ip地址,作为CDN的源,实际上等于直接设置ip.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;del>Cloudfront 上传按量收费，下载1TB以内免费，所以可以下行走Cloudfront上行走别的&lt;/del>&lt;br>
实测不主动上传文件,总流量200GB以内一般不会收费(会产生0.0x美元的账单但不会从卡里扣钱)&lt;/p>
&lt;/li>
&lt;/ul></description></item></channel></rss>